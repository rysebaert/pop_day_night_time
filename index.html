<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ronan Ysebaert">
<meta name="dcterms.date" content="2023-10-13">

<title>Population over the day, the night, the seasons</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#general-objectives-and-data-presentation" id="toc-general-objectives-and-data-presentation" class="nav-link active" data-scroll-target="#general-objectives-and-data-presentation">General objectives and data presentation</a>
  <ul class="collapse">
  <li><a href="#r-libraries" id="toc-r-libraries" class="nav-link" data-scroll-target="#r-libraries">R Libraries</a></li>
  <li><a href="#import-and-view-input-data" id="toc-import-and-view-input-data" class="nav-link" data-scroll-target="#import-and-view-input-data">Import and view input data</a></li>
  </ul></li>
  <li><a href="#methodologicial-framework-applied-to-ile-de-france" id="toc-methodologicial-framework-applied-to-ile-de-france" class="nav-link" data-scroll-target="#methodologicial-framework-applied-to-ile-de-france">Methodologicial framework applied to Ile-de-France</a>
  <ul class="collapse">
  <li><a href="#data-processing" id="toc-data-processing" class="nav-link" data-scroll-target="#data-processing">Data processing</a></li>
  <li><a href="#visualizations" id="toc-visualizations" class="nav-link" data-scroll-target="#visualizations">Visualizations</a></li>
  </ul></li>
  <li><a href="#london-uk" id="toc-london-uk" class="nav-link" data-scroll-target="#london-uk">London (UK)</a></li>
  <li><a href="#auvergne-rhône-alpes-fr" id="toc-auvergne-rhône-alpes-fr" class="nav-link" data-scroll-target="#auvergne-rhône-alpes-fr">Auvergne-Rhône-Alpes (FR)</a></li>
  <li><a href="#bretagne-fr" id="toc-bretagne-fr" class="nav-link" data-scroll-target="#bretagne-fr">Bretagne (FR)</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Population over the day, the night, the seasons</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <a href="https://rysebaert.github.io/climbing_paris/">Ronan Ysebaert</a> 
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://riate.cnrs.fr/">
            UAR RIATE, Université Paris Cité, CNRS
            </a>
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 13, 2023</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="general-objectives-and-data-presentation" class="level1">
<h1>General objectives and data presentation</h1>
<p>The <a href="https://ghsl.jrc.ec.europa.eu/ENACT_POP.php">ENACT-POP R2020A dataset</a> is a spatial raster dataset provided by JRC (<span class="citation" data-cites="schiavina2020">Schiavina et al. (<a href="#ref-schiavina2020" role="doc-biblioref">2020</a>)</span>). It depicts the seasonal nightime and daytime population in a 1km grid resolution for 2011. It covers EU28.</p>
<p>These 24 datasets (one for each month, and one for daytime and nightime) are bassed on a <em>multi-layered dasymetric approach tjat models the spatial distribution of different population groups sepatately and according to a selection of covariates derived from novel geospatial data sources</em> (<span class="citation" data-cites="batista2020">Batista e Silva et al. (<a href="#ref-batista2020" role="doc-biblioref">2020</a>)</span>)</p>
<p>It follows four interlinked phases <span class="citation" data-cites="batista2020">Batista e Silva et al. (<a href="#ref-batista2020" role="doc-biblioref">2020</a>)</span> :</p>
<ol type="1">
<li><strong>Estimation of monthly and regional stocks of population groups</strong>: residents, employees by economic sectors, students by education level, non-working and non-studying population, tourists (provided by Eurostat).</li>
<li><strong>Mapping of Land Use features relevant to the location of the population groups</strong>: 11 artificial land use classes (Corine Land Cover 2012) including production facilities, commercial and service facilities, public facilities and airport terminals. It has been associated to Point of Interests (TomTom Multinet and OpenStreetMap) to present locations of activities and facilities associated to students and workers. For each population group, the relevant features were processed into a signle binay raster layer with a 100 x 100m resolution. For the disaggregation of tourists, they built a layer reporting touristic accomodation room density based on data from online booking platforms.<br>
</li>
<li><strong>Dasymetric dissaggregation of population groups stocks to their most likely locations within regions</strong> : the stock of a population group within a region is first divided over the land use types relvant to that group proportional to the occurence of these land use types within the region. The downscaling procedure generates 204 intermediate population grids (12 months x 17 population groups) at a spatial resolution of 100 metres. For each month of the year, the respective nighttime population grid was the result of the sum of the gridded residents with the gridded tourists at nighttime. Conversely, the daytime population grid was the result of the sum of the 15 remainder population group grids. The final 24 grids were obtained by aggregating the 100 m pixel values to the target 1 km2 grid cells.</li>
<li>Quality asssesmment by means of a cross-comparison against independ datasets for selected countries : with comuting of students and workers for Italy, Spain and Portugal ; cellphone reccords in Belgium.</li>
</ol>
<p>The GHSL - Global Human Settlement Layer proposes a data viewer to interactively explore the results, <a href="https://ghsl.jrc.ec.europa.eu/enactVisualisation.php">here</a>. However, the tool is not especially suitable to :</p>
<ol type="1">
<li>Compare monthes, daytime and nightime. The user must change the layer selected manually.</li>
<li>Observe spatial trends outside the mosaic of grid cells.</li>
</ol>
<p>We propose consequently in this notebook a methodological framework for analysing the seasonal and daytime changes based on spatial interpolation method (<span class="citation" data-cites="stewart1942">Stewart (<a href="#ref-stewart1942" role="doc-biblioref">1942</a>)</span>), allowing to observe the phenomenon on a continuous surface from a set of discrete points.</p>
<section id="r-libraries" class="level2">
<h2 class="anchored" data-anchor-id="r-libraries">R Libraries</h2>
<p>NUTS units are imported with the <a href="https://cran.r-project.org/web/packages/giscoR/index.html"><code>giscoR</code></a> package</p>
<p>For spatial data handling, <a href="https://cran.r-project.org/web/packages/terra/index.html"><code>terra</code></a> is used for manipulating raster tiles, <a href="https://cran.r-project.org/web/packages/sf/index.html"><code>sf</code></a> for manipulating vector geometries, <a href="https://cran.r-project.org/web/packages/potential/index.html"><code>potential</code></a> for implementing the Potential model as definded by <span class="citation" data-cites="stewart1942">Stewart (<a href="#ref-stewart1942" role="doc-biblioref">1942</a>)</span>.</p>
<p><a href="https://cran.r-project.org/web/packages/mapsf/index.html"><code>mapsf</code></a> is used for thematic mapping and <a href="https://cran.r-project.org/web/packages/maptiles/index.html"><code>maptiles</code></a> for displaying some useful labels on maps.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(giscoR)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Manupulating geographical objects</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(potential)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapping</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapsf)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maptiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="import-and-view-input-data" class="level2">
<h2 class="anchored" data-anchor-id="import-and-view-input-data">Import and view input data</h2>
<p>Import and view raw data. It corresponds to rasters covering all Europe. Three layers are imported :</p>
<ul>
<li>Population in January, daytime.</li>
<li>Population in January, nightime.</li>
<li>Population in August, daytime.</li>
</ul>
<p>Here is a map of the raw data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>JAN_D <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"data-raw/ENACT_POP_D012011_EU28_R2020A_3035_1K_V1_0.tif"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>JAN_N <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"data-raw/ENACT_POP_N012011_EU28_R2020A_3035_1K_V1_0.tif"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>AOU_D <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"data-raw/ENACT_POP_D082011_EU28_R2020A_3035_1K_V1_0.tif"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># View</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(JAN_D)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="methodologicial-framework-applied-to-ile-de-france" class="level1">
<h1>Methodologicial framework applied to Ile-de-France</h1>
<section id="data-processing" class="level2">
<h2 class="anchored" data-anchor-id="data-processing">Data processing</h2>
<p>The raster is reprojected in the European reference projection.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>JAN_D <span class="ot">&lt;-</span> <span class="fu">project</span>(<span class="at">x=</span> JAN_D, <span class="at">y =</span>  <span class="st">"EPSG:3035"</span>, <span class="at">method =</span> <span class="st">"bilinear"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
|---------|---------|---------|---------|
=========================================
                                          </code></pre>
</div>
</div>
<p>Import European regions with <code>giscoR</code> R package, that will be used for selecting regions of interest.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>nuts1 <span class="ot">&lt;-</span> <span class="fu">gisco_get_nuts</span>(<span class="at">year =</span> <span class="st">"2021"</span>, <span class="at">epsg =</span> <span class="st">"3035"</span>, <span class="at">resolution =</span> <span class="st">"03"</span>, </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nuts_level =</span> <span class="st">"1"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>nuts2 <span class="ot">&lt;-</span> <span class="fu">gisco_get_nuts</span>(<span class="at">year =</span> <span class="st">"2021"</span>, <span class="at">epsg =</span> <span class="st">"3035"</span>, <span class="at">resolution =</span> <span class="st">"03"</span>, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nuts_level =</span> <span class="st">"2"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>nuts3 <span class="ot">&lt;-</span> <span class="fu">gisco_get_nuts</span>(<span class="at">year =</span> <span class="st">"2021"</span>, <span class="at">epsg =</span> <span class="st">"3035"</span>, <span class="at">resolution =</span> <span class="st">"03"</span>, </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nuts_level =</span> <span class="st">"3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We then choose the Ile-de-France region (FR10). Territorial unit is extracted from the original NUTS layer, rasterized and croped to the original layer.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select region</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>nuts_code <span class="ot">&lt;-</span> <span class="st">"FR10"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>nuts2_sel <span class="ot">&lt;-</span> nuts2[nuts2<span class="sc">$</span>NUTS_ID <span class="sc">==</span> nuts_code,]</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>nuts3_sel <span class="ot">&lt;-</span> nuts3[<span class="fu">substr</span>(nuts3<span class="sc">$</span>NUTS_ID, <span class="dv">1</span>, <span class="dv">4</span>) <span class="sc">==</span> nuts_code,]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform to raster</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>sel <span class="ot">&lt;-</span> <span class="fu">vect</span>(nuts2_sel)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Crop and mask the original layer to the region of interest</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>crop_JAN_D <span class="ot">&lt;-</span> <span class="fu">crop</span>(JAN_D, sel)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>mask_JAN_D <span class="ot">&lt;-</span> <span class="fu">mask</span>(crop_JAN_D, sel)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># See result</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mask_JAN_D)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This raster is afterwards vectorized. We give an unique ID and a given column name for simplifying furtuer operation and merges. The map below shows the resulting output vectorized layer.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vectorize result</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>JAN_D_sel <span class="ot">&lt;-</span> <span class="fu">as.points</span>(mask_JAN_D)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>JAN_D_sel <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(JAN_D_sel)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Harmonize column names</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>JAN_D_sel<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="fu">row.names</span>(JAN_D_sel)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(JAN_D_sel)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"POP_JANV_D_2011"</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Map of values above 1</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> JAN_D_sel[JAN_D_sel<span class="sc">$</span>POP_JANV_D_2011 <span class="sc">&gt;</span> <span class="dv">1</span>,]</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>tmp2 <span class="ot">&lt;-</span> JAN_D_sel[JAN_D_sel<span class="sc">$</span>POP_JANV_D_2011 <span class="sc">&lt;</span> <span class="dv">1</span>,]</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(tmp2, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">col =</span> <span class="st">"lightgrey"</span>, <span class="at">cex =</span> .<span class="dv">6</span>, <span class="at">border =</span> <span class="cn">NA</span>) </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(tmp, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">var =</span> <span class="st">"POP_JANV_D_2011"</span>, <span class="at">type =</span> <span class="st">"choro"</span>, <span class="at">nbreaks =</span> <span class="dv">8</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">cex =</span> .<span class="dv">6</span>, <span class="at">add =</span> <span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We implement a function to do all this stuff in a synthetic way. It allows to build vector layer for a reference input layer (the raw files) according to a region of interest. This is done for the layer with population in nightime in January (JAN_N) and daytime in August (AOU_D).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>enact_extract <span class="ot">&lt;-</span> <span class="cf">function</span>(x, var_name, sel){</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reproject data</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">project</span>(<span class="at">x=</span> x, <span class="at">y =</span>  <span class="st">"EPSG:3035"</span>, <span class="at">method =</span> <span class="st">"bilinear"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter for a given region</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  sel <span class="ot">&lt;-</span> <span class="fu">vect</span>(sel)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">crop</span>(x, sel)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">mask</span>(x, sel)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Vectorize output</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.points</span>(x)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(x)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Identifiers and colnames</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="fu">row.names</span>(x)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x)[<span class="dv">1</span>] <span class="ot">&lt;-</span> var_name</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>JAN_N_sel <span class="ot">&lt;-</span> <span class="fu">enact_extract</span>(<span class="at">x =</span> JAN_N, <span class="at">sel =</span> nuts2_sel, <span class="at">var_name =</span> <span class="st">"POP_JANV_N_2011"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
|---------|---------|---------|---------|
=========================================
                                          </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>AOU_D_sel <span class="ot">&lt;-</span> <span class="fu">enact_extract</span>(<span class="at">x =</span> AOU_D, <span class="at">sel =</span> nuts2_sel, <span class="at">var_name =</span> <span class="st">"POP_AOU_D_2011"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
|---------|---------|---------|---------|
=========================================
                                          </code></pre>
</div>
</div>
<p>These layers are merged to the first one. Data is prepared !</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>JAN_N_sel <span class="ot">&lt;-</span><span class="fu">st_set_geometry</span>(JAN_N_sel, <span class="cn">NULL</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>AOU_D_sel <span class="ot">&lt;-</span><span class="fu">st_set_geometry</span>(AOU_D_sel, <span class="cn">NULL</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>pt <span class="ot">&lt;-</span> <span class="fu">merge</span>(JAN_D_sel, JAN_N_sel[,,<span class="at">drop =</span> <span class="cn">TRUE</span>], <span class="at">by =</span> <span class="st">"ID"</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>pt <span class="ot">&lt;-</span> <span class="fu">merge</span>(pt, AOU_D_sel, <span class="at">by =</span> <span class="st">"ID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="visualizations" class="level2">
<h2 class="anchored" data-anchor-id="visualizations">Visualizations</h2>
<section id="difference-in-daytime-by-nuts3" class="level3">
<h3 class="anchored" data-anchor-id="difference-in-daytime-by-nuts3">Difference in daytime, by NUTS3</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only points covering the study area</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>pt_n3 <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(pt, nuts3_sel)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>pt_n3 <span class="ot">&lt;-</span> <span class="fu">st_set_geometry</span>(pt_n3, <span class="cn">NULL</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate results by NUTS3</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>n3 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(pt_n3[,<span class="fu">c</span>(<span class="st">"POP_JANV_D_2011"</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"POP_JANV_N_2011"</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"POP_AOU_D_2011"</span>)],</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="fu">list</span>(<span class="at">NAME_LATN =</span> pt_n3<span class="sc">$</span>NAME_LATN),</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">FUN =</span> sum)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Population in thousands</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>n3[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)] <span class="ot">&lt;-</span> n3[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)] <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Barplot</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>), <span class="at">cex.main =</span> <span class="fl">0.9</span>, <span class="at">cex.lab =</span> <span class="fl">0.8</span>, <span class="at">cex.axis =</span> <span class="fl">0.7</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">cbind</span>(POP_JANV_D_2011,POP_JANV_N_2011) <span class="sc">~</span> NAME_LATN, <span class="at">data =</span> n3, <span class="at">beside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">border =</span> <span class="cn">FALSE</span>, <span class="at">las =</span> <span class="dv">2</span> , <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"#f7b26d"</span>, <span class="st">"#6d86f7"</span>), <span class="at">xlab =</span><span class="st">""</span>, <span class="at">axes =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Population (Thousands)"</span>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span> (<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Day"</span>,<span class="st">"Night"</span>),</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="fu">c</span>(<span class="st">"#f7b26d"</span>, <span class="st">"#6d86f7"</span>), <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">bg =</span> <span class="cn">NA</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Resident population, depending on the period of the day"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Population potentials for daytime and nightime are computed in a neighbourhood of 2000 meters.</p>
<p>It requires first to create a regular grid with the extent of Ile-de-France. Then the <code>mcpotential</code> function computes potentials on the basis of a distance matrix between the created grid (y) and the observed population (pt) in nightime and daytime. To understand more in detail the methodology behind and the core arguments (span, limit, beta), have a look to <span class="citation" data-cites="giraud2022">Giraud (<a href="#ref-giraud2022" role="doc-biblioref">2022</a>)</span>.</p>
<p>Then, the 2 potential are divided and normalized in index 100. 100 corresponding to the population in nightime. Deciles of the resulting indicator are extracted to build polygons of equipotential from the regular grid of potential points.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 1km reggular grid</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">create_grid</span>(<span class="at">x =</span> pt, <span class="at">res =</span> <span class="dv">1000</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Potential in a neighbourhood of 5000m</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>POT_JAN_D <span class="ot">&lt;-</span>  <span class="fu">mcpotential</span>(<span class="at">x =</span> pt, <span class="at">y =</span> y, <span class="at">var =</span> <span class="st">"POP_JANV_D_2011"</span>, <span class="at">fun =</span> <span class="st">"e"</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">span =</span> <span class="dv">2000</span>, <span class="at">limit =</span> <span class="dv">10000</span>, <span class="at">beta =</span> <span class="dv">2</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>POT_JAN_N <span class="ot">&lt;-</span>  <span class="fu">mcpotential</span>(<span class="at">x =</span> pt, <span class="at">y =</span> y, <span class="at">var =</span> <span class="st">"POP_JANV_N_2011"</span>, <span class="at">fun =</span> <span class="st">"e"</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>                            <span class="at">span =</span> <span class="dv">2000</span>, <span class="at">limit =</span> <span class="dv">10000</span>, <span class="at">beta =</span> <span class="dv">2</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Resident population day / night</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>DIFF_D <span class="ot">&lt;-</span> y<span class="sc">$</span>POT_JAN_D <span class="sc">/</span> y<span class="sc">$</span>POT_JAN_N <span class="sc">*</span> <span class="dv">100</span> </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Quantiles 10, classes, covering the study area</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(y, nuts2_sel)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">&lt;-</span> discr[,<span class="st">"DIFF_D"</span>, drop <span class="ot">=</span> <span class="cn">TRUE</span>]</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">&lt;-</span> <span class="fu">quantile</span>(discr, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Equipotential</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>iso <span class="ot">&lt;-</span> <span class="fu">equipotential</span>(<span class="at">x =</span> y, <span class="at">var =</span> <span class="st">"DIFF_D"</span>, <span class="at">breaks =</span> discr, <span class="at">mask =</span> nuts2_sel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>It allows to build a map. Separation between warm and cold colours corresponds to the class threshold the most closed to 100. 100 meaning equal population in nightime and daytime.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diverging palette around 100</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>div <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">abs</span>(discr<span class="dv">-100</span>) <span class="sc">==</span> <span class="fu">min</span>(<span class="fu">abs</span>(discr<span class="dv">-100</span>)))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> cols <span class="ot">&lt;-</span> <span class="fu">mf_get_pal</span>(<span class="at">n =</span> <span class="fu">c</span>(div<span class="dv">-1</span>, <span class="dv">11</span><span class="sc">-</span>div), <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"Purp"</span>, <span class="st">"YlOrRd"</span>))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Map</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>))</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> iso, <span class="at">var =</span> <span class="st">"min"</span>, <span class="at">type =</span> <span class="st">"choro"</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">breaks =</span> discr, <span class="at">pal =</span> pal, <span class="at">lwd =</span> .<span class="dv">2</span>, <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">leg_val_rnd =</span> <span class="dv">1</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_pos =</span> <span class="st">"topleft"</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_title =</span> <span class="fu">paste0</span>(<span class="st">"Difference in resident_population</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Between the day and the night</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"in 2011 (100 = resident population at night)"</span>))</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> nuts3_sel, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>tiles_front <span class="ot">&lt;-</span> <span class="fu">get_tiles</span>(nuts2_sel, <span class="at">crop =</span> <span class="cn">TRUE</span>, <span class="at">provider =</span> <span class="st">"CartoDB.PositronOnlyLabels"</span>, <span class="at">zoom =</span> <span class="dv">9</span>)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_tiles</span>(tiles_front, <span class="at">add =</span> <span class="cn">TRUE</span>)  </span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_layout</span>(<span class="at">title =</span> <span class="st">"Resident population - daytime difference"</span>, </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">credits =</span> <span class="fu">paste0</span>(<span class="st">"Realisation : Ronan Ysebaert, 2023"</span>,</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Data source : ENACT-POP (Global Human Settlement Layer, JRC, European Commission, 2023"</span>),</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">arrow =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="seasonal-trend" class="level3">
<h3 class="anchored" data-anchor-id="seasonal-trend">Seasonal trend</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>), <span class="at">cex.main =</span> <span class="fl">0.9</span>, <span class="at">cex.lab =</span> <span class="fl">0.8</span>, <span class="at">cex.axis =</span> <span class="fl">0.7</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">cbind</span>(POP_JANV_D_2011,POP_AOU_D_2011) <span class="sc">~</span> NAME_LATN, <span class="at">data =</span> n3, <span class="at">beside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">border =</span> <span class="cn">FALSE</span>, <span class="at">las =</span> <span class="dv">2</span> , <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"#6bc982"</span>, <span class="st">"#ff697a"</span>), <span class="at">xlab =</span><span class="st">""</span>, <span class="at">axes =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Population (Thousands)"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span> (<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"January"</span>,<span class="st">"August"</span>),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="fu">c</span>(<span class="st">"#6bc982"</span>, <span class="st">"#ff697a"</span>), <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">bg =</span> <span class="cn">NA</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Resident population, depending on the season"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For the seasonal trend we look into the absolute difference between population in January and August. The resulting picture is not exactly the same than the previous map as it highlights the population gain / loss over the seasons.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute potential</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>POT_AOU_D <span class="ot">&lt;-</span>  <span class="fu">mcpotential</span>(<span class="at">x =</span> pt, <span class="at">y =</span> y, <span class="at">var =</span> <span class="st">"POP_AOU_D_2011"</span>, <span class="at">fun =</span> <span class="st">"e"</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">span =</span> <span class="dv">2000</span>, <span class="at">limit =</span> <span class="dv">10000</span>, <span class="at">beta =</span> <span class="dv">2</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Resident population day / night</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>DIFF_D <span class="ot">&lt;-</span>  y<span class="sc">$</span>POT_AOU_D <span class="sc">-</span> y<span class="sc">$</span>POT_JAN_D</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Quantiles 10, classes, covering the study area</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(y, nuts2_sel)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">&lt;-</span> discr[,<span class="st">"DIFF_D"</span>, drop <span class="ot">=</span> <span class="cn">TRUE</span>]</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">&lt;-</span> <span class="fu">quantile</span>(discr, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Diverging palette around 100</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>div <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">abs</span>(discr<span class="dv">-100</span>) <span class="sc">==</span> <span class="fu">min</span>(<span class="fu">abs</span>(discr<span class="dv">-100</span>)))</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> cols <span class="ot">&lt;-</span> <span class="fu">mf_get_pal</span>(<span class="at">n =</span> <span class="fu">c</span>(div<span class="dv">-1</span>, <span class="dv">11</span><span class="sc">-</span>div), <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"Reds 3"</span>, <span class="st">"Greens 3"</span>))</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Equipotential</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>iso <span class="ot">&lt;-</span> <span class="fu">equipotential</span>(<span class="at">x =</span> y, <span class="at">var =</span> <span class="st">"DIFF_D"</span>, <span class="at">breaks =</span> discr, <span class="at">mask =</span> nuts2_sel)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Map</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>))</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> iso, <span class="at">var =</span> <span class="st">"min"</span>, <span class="at">type =</span> <span class="st">"choro"</span>,</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">breaks =</span> discr, <span class="at">pal =</span> pal, <span class="at">lwd =</span> .<span class="dv">2</span>, <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">leg_val_rnd =</span> <span class="dv">1</span>,</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_pos =</span> <span class="st">"topleft"</span>,</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_title =</span> <span class="fu">paste0</span>(<span class="st">"Difference in resident_population</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Between August and January"</span>))</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> nuts3_sel, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>tiles_front <span class="ot">&lt;-</span> <span class="fu">get_tiles</span>(nuts2_sel, <span class="at">crop =</span> <span class="cn">TRUE</span>, <span class="at">provider =</span> <span class="st">"CartoDB.PositronOnlyLabels"</span>, <span class="at">zoom =</span> <span class="dv">9</span>)</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_tiles</span>(tiles_front, <span class="at">add =</span> <span class="cn">TRUE</span>)  </span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_layout</span>(<span class="at">title =</span> <span class="st">"Resident population - seasonal difference"</span>, </span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">credits =</span> <span class="fu">paste0</span>(<span class="st">"Realisation : Ronan Ysebaert, 2023</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Data source : ENACT-POP (Global Human Settlement Layer, JRC, European Commission, 2023"</span>),</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>          <span class="at">arrow =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="london-uk" class="level1">
<h1>London (UK)</h1>
<p>Adapting this methodological framework to other regions is afterwards quite easy. Let’s analyse the situation in London between daytime and nightime in January…</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
|---------|---------|---------|---------|
=========================================
                                          </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
|---------|---------|---------|---------|
=========================================
                                          </code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="auvergne-rhône-alpes-fr" class="level1">
<h1>Auvergne-Rhône-Alpes (FR)</h1>
<p>… Or in Auvergne-Rhônes-Alpes region in France between January and August. The span of the Stewart’s potential has been enlarged to 5000 meters instead of 2000 meters to observe more general trends.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
|---------|---------|---------|---------|
=========================================
                                          </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
|---------|---------|---------|---------|
=========================================
                                          </code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="bretagne-fr" class="level1">
<h1>Bretagne (FR)</h1>
<p>And in Bretagne region in France between January and August.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
|---------|---------|---------|---------|
=========================================
                                          </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
|---------|---------|---------|---------|
=========================================
                                          </code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.2.2 (2022-10-31 ucrt)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 19045)

Matrix products: default

locale:
[1] LC_COLLATE=French_France.utf8  LC_CTYPE=French_France.utf8   
[3] LC_MONETARY=French_France.utf8 LC_NUMERIC=C                  
[5] LC_TIME=French_France.utf8    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] maptiles_0.4.0  mapsf_0.6.1     potential_0.2.0 sf_1.0-10      
[5] terra_1.7-18    giscoR_0.3.3   

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.10        compiler_4.2.2     pillar_1.8.1       iterators_1.0.14  
 [5] class_7.3-20       tools_4.2.2        digest_0.6.31      jsonlite_1.8.4    
 [9] evaluate_0.20      lifecycle_1.0.3    tibble_3.2.0       png_0.1-8         
[13] pkgconfig_2.0.3    rlang_1.1.0        foreach_1.5.2      DBI_1.1.3         
[17] cli_3.6.0          rstudioapi_0.14    curl_5.0.0         parallel_4.2.2    
[21] yaml_2.3.7         xfun_0.37          fastmap_1.1.1      e1071_1.7-13      
[25] dplyr_1.1.0        knitr_1.42         generics_0.1.3     htmlwidgets_1.6.1 
[29] vctrs_0.5.2        isoband_0.2.7      tidyselect_1.2.0   classInt_0.4-9    
[33] grid_4.2.2         glue_1.6.2         geojsonsf_2.0.3    R6_2.5.1          
[37] fansi_1.0.4        rmarkdown_2.20     purrr_1.0.1        magrittr_2.0.3    
[41] codetools_0.2-18   htmltools_0.5.4    units_0.8-1        slippymath_0.3.1  
[45] KernSmooth_2.23-20 utf8_1.2.3         proxy_0.4-27       doParallel_1.0.17 </code></pre>
</div>
</div>
<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-batista2020" class="csl-entry" role="doc-biblioentry">
Batista e Silva, Freire, Schiavina, Rosina, Marín-Herrera, Ziemba, Craglia, Koomen, and Lavalle. 2020. <span>“Uncovering Temporal Changes in Europe’s Population Density Patterns Using a Data Fusion Approach.”</span> <em>Nature Communications</em> 4631-11. https://doi.org/<a href="https://doi.org/10.1038/s41467-020-18344-5">https://doi.org/10.1038/s41467-020-18344-5</a>.
</div>
<div id="ref-giraud2022" class="csl-entry" role="doc-biblioentry">
Giraud. 2022. <em>Potential: Historic and Conceptual Background</em>. <a href="https://cran.r-project.org/web/packages/potential/vignettes/potential.html">https://cran.r-project.org/web/packages/potential/vignettes/potential.html</a>.
</div>
<div id="ref-schiavina2020" class="csl-entry" role="doc-biblioentry">
Schiavina, Freire, Rosina, Ziemba, Marin Herrera, Craglia, Lavalle, Kemer, and Batista e Silva. 2020. <span>“ENACT-POP R2020A - ENACT 2011 Population Grid.”</span> European Commission, Joint Research Centre (JRC). <a href="https://doi.org/10.2905/347F0337-F2DA-4592-87B3-E25975EC2C95">https://doi.org/10.2905/347F0337-F2DA-4592-87B3-E25975EC2C95</a>.
</div>
<div id="ref-stewart1942" class="csl-entry" role="doc-biblioentry">
Stewart. 1942. <span>“A Measure of the Influence of a Population at a Distance.”</span> <em>Sociometry</em> n° 5: 63–71. <a href="https://doi.org/10.1126/science.93.2404.89">https://doi.org/10.1126/science.93.2404.89</a>.
</div>
</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{ysebaert,
  author = {Ronan Ysebaert},
  editor = {},
  title = {Population over the Day, the Night, the Seasons},
  date = {},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-ysebaert" class="csl-entry quarto-appendix-citeas" role="doc-biblioentry">
Ronan Ysebaert. n.d. <span>“Population over the Day, the Night, the
Seasons.”</span>
</div></div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb26" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Population over the day, the night, the seasons"</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Ronan Ysebaert </span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://rysebaert.github.io/climbing_paris/</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: UAR RIATE, Université Paris Cité, CNRS</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation-url: https://riate.cnrs.fr/</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span><span class="co"> true</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r Sys.Date()`"</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> bib.bib</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: sandstone</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="co">    fontsize: 0.9em</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 2</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="co">    css: "styles.css"</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="co">    linkcolor: "#8631ad"</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="fu"># General objectives and data presentation</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">ENACT-POP R2020A dataset</span><span class="co">](https://ghsl.jrc.ec.europa.eu/ENACT_POP.php)</span> is a spatial raster dataset provided by JRC (@schiavina2020). It depicts the seasonal nightime and daytime population in a 1km grid resolution for 2011. It covers EU28.</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>These 24 datasets (one for each month, and one for daytime and nightime) are bassed on a *multi-layered dasymetric approach tjat models the spatial distribution of different population groups sepatately and according to a selection of covariates derived from novel geospatial data sources* (@batista2020)</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>It follows four interlinked phases @batista2020 :</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Estimation of monthly and regional stocks of population groups**: residents, employees by economic sectors, students by education level, non-working and non-studying population, tourists (provided by Eurostat). </span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Mapping of Land Use features relevant to the location of the population groups**: 11 artificial land use classes (Corine Land Cover 2012) including production facilities, commercial and service facilities, public facilities and airport terminals. It has been associated to Point of Interests (TomTom Multinet and OpenStreetMap) to present locations of activities and facilities associated to students and workers. For each population group, the relevant features were processed into a signle binay raster layer with a 100 x 100m resolution. For the disaggregation of tourists, they built a layer reporting touristic accomodation room density based on data from online booking platforms.  </span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Dasymetric dissaggregation of population groups stocks to their most likely locations within regions** : the stock of a population group within a region is first divided over the land use types relvant to that group proportional to the occurence of these land use types within the region. The downscaling procedure generates 204 intermediate population grids (12 months x 17 population groups) at a spatial resolution of 100 metres. For each month of the year, the respective nighttime population grid was the result of the sum of the gridded residents with the gridded tourists at nighttime. Conversely, the daytime population grid was the result of the sum of the 15 remainder population group grids. The final 24 grids were obtained by aggregating the 100 m pixel values to the target 1 km2 grid cells.</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Quality asssesmment by means of a cross-comparison against independ datasets for selected countries : with comuting of students and workers for Italy, Spain and Portugal ; cellphone reccords in Belgium.  </span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>The GHSL - Global Human Settlement Layer proposes a data viewer to interactively explore the results, <span class="co">[</span><span class="ot">here</span><span class="co">](https://ghsl.jrc.ec.europa.eu/enactVisualisation.php)</span>. However, the tool is not especially suitable to :</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>(1) Compare monthes, daytime and nightime. The user must change the layer selected manually. </span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>(2) Observe spatial trends outside the mosaic of grid cells. </span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>We propose consequently in this notebook a methodological framework for analysing the seasonal and daytime changes based on spatial interpolation method (@stewart1942), allowing to observe the phenomenon on a continuous surface from a set of discrete points. </span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a><span class="fu">## R Libraries</span></span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>NUTS units are imported with the <span class="co">[</span><span class="ot">`giscoR`</span><span class="co">](https://cran.r-project.org/web/packages/giscoR/index.html)</span> package</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>For spatial data handling, <span class="co">[</span><span class="ot">`terra`</span><span class="co">](https://cran.r-project.org/web/packages/terra/index.html)</span> is used for manipulating raster tiles, <span class="co">[</span><span class="ot">`sf`</span><span class="co">](https://cran.r-project.org/web/packages/sf/index.html)</span> for manipulating vector geometries, <span class="co">[</span><span class="ot">`potential`</span><span class="co">](https://cran.r-project.org/web/packages/potential/index.html)</span> for implementing the Potential model as definded by @stewart1942.</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">`mapsf`</span><span class="co">](https://cran.r-project.org/web/packages/mapsf/index.html)</span> is used for thematic mapping and <span class="co">[</span><span class="ot">`maptiles`</span><span class="co">](https://cran.r-project.org/web/packages/maptiles/index.html)</span> for displaying some useful labels on maps. </span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data</span></span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(giscoR)</span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Manupulating geographical objects</span></span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(potential)</span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapping</span></span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapsf)</span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maptiles)</span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a><span class="fu">## Import and view input data</span></span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a>Import and view raw data. It corresponds to rasters covering all Europe. Three layers are imported :</span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Population in January, daytime.</span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Population in January, nightime.</span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Population in August, daytime. </span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a>Here is a map of the raw data. </span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-87"><a href="#cb26-87" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-88"><a href="#cb26-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data</span></span>
<span id="cb26-89"><a href="#cb26-89" aria-hidden="true" tabindex="-1"></a>JAN_D <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"data-raw/ENACT_POP_D012011_EU28_R2020A_3035_1K_V1_0.tif"</span>)</span>
<span id="cb26-90"><a href="#cb26-90" aria-hidden="true" tabindex="-1"></a>JAN_N <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"data-raw/ENACT_POP_N012011_EU28_R2020A_3035_1K_V1_0.tif"</span>)</span>
<span id="cb26-91"><a href="#cb26-91" aria-hidden="true" tabindex="-1"></a>AOU_D <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"data-raw/ENACT_POP_D082011_EU28_R2020A_3035_1K_V1_0.tif"</span>)</span>
<span id="cb26-92"><a href="#cb26-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-93"><a href="#cb26-93" aria-hidden="true" tabindex="-1"></a><span class="co"># View</span></span>
<span id="cb26-94"><a href="#cb26-94" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(JAN_D)</span>
<span id="cb26-95"><a href="#cb26-95" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-96"><a href="#cb26-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-97"><a href="#cb26-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-98"><a href="#cb26-98" aria-hidden="true" tabindex="-1"></a><span class="fu"># Methodologicial framework applied to Ile-de-France</span></span>
<span id="cb26-99"><a href="#cb26-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-100"><a href="#cb26-100" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data processing</span></span>
<span id="cb26-101"><a href="#cb26-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-102"><a href="#cb26-102" aria-hidden="true" tabindex="-1"></a>The raster is reprojected in the European reference projection. </span>
<span id="cb26-103"><a href="#cb26-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-106"><a href="#cb26-106" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-107"><a href="#cb26-107" aria-hidden="true" tabindex="-1"></a>JAN_D <span class="ot">&lt;-</span> <span class="fu">project</span>(<span class="at">x=</span> JAN_D, <span class="at">y =</span>  <span class="st">"EPSG:3035"</span>, <span class="at">method =</span> <span class="st">"bilinear"</span>)</span>
<span id="cb26-108"><a href="#cb26-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-109"><a href="#cb26-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-110"><a href="#cb26-110" aria-hidden="true" tabindex="-1"></a>Import European regions with <span class="in">`giscoR`</span> R package, that will be used for selecting regions of interest. </span>
<span id="cb26-111"><a href="#cb26-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-114"><a href="#cb26-114" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-115"><a href="#cb26-115" aria-hidden="true" tabindex="-1"></a>nuts1 <span class="ot">&lt;-</span> <span class="fu">gisco_get_nuts</span>(<span class="at">year =</span> <span class="st">"2021"</span>, <span class="at">epsg =</span> <span class="st">"3035"</span>, <span class="at">resolution =</span> <span class="st">"03"</span>, </span>
<span id="cb26-116"><a href="#cb26-116" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nuts_level =</span> <span class="st">"1"</span>)</span>
<span id="cb26-117"><a href="#cb26-117" aria-hidden="true" tabindex="-1"></a>nuts2 <span class="ot">&lt;-</span> <span class="fu">gisco_get_nuts</span>(<span class="at">year =</span> <span class="st">"2021"</span>, <span class="at">epsg =</span> <span class="st">"3035"</span>, <span class="at">resolution =</span> <span class="st">"03"</span>, </span>
<span id="cb26-118"><a href="#cb26-118" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nuts_level =</span> <span class="st">"2"</span>)</span>
<span id="cb26-119"><a href="#cb26-119" aria-hidden="true" tabindex="-1"></a>nuts3 <span class="ot">&lt;-</span> <span class="fu">gisco_get_nuts</span>(<span class="at">year =</span> <span class="st">"2021"</span>, <span class="at">epsg =</span> <span class="st">"3035"</span>, <span class="at">resolution =</span> <span class="st">"03"</span>, </span>
<span id="cb26-120"><a href="#cb26-120" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nuts_level =</span> <span class="st">"3"</span>)</span>
<span id="cb26-121"><a href="#cb26-121" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-122"><a href="#cb26-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-123"><a href="#cb26-123" aria-hidden="true" tabindex="-1"></a>We then choose the Ile-de-France region (FR10). Territorial unit is extracted from the original NUTS layer, rasterized and croped to the original layer.  </span>
<span id="cb26-124"><a href="#cb26-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-127"><a href="#cb26-127" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-128"><a href="#cb26-128" aria-hidden="true" tabindex="-1"></a><span class="co"># Select region</span></span>
<span id="cb26-129"><a href="#cb26-129" aria-hidden="true" tabindex="-1"></a>nuts_code <span class="ot">&lt;-</span> <span class="st">"FR10"</span></span>
<span id="cb26-130"><a href="#cb26-130" aria-hidden="true" tabindex="-1"></a>nuts2_sel <span class="ot">&lt;-</span> nuts2[nuts2<span class="sc">$</span>NUTS_ID <span class="sc">==</span> nuts_code,]</span>
<span id="cb26-131"><a href="#cb26-131" aria-hidden="true" tabindex="-1"></a>nuts3_sel <span class="ot">&lt;-</span> nuts3[<span class="fu">substr</span>(nuts3<span class="sc">$</span>NUTS_ID, <span class="dv">1</span>, <span class="dv">4</span>) <span class="sc">==</span> nuts_code,]</span>
<span id="cb26-132"><a href="#cb26-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-133"><a href="#cb26-133" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform to raster</span></span>
<span id="cb26-134"><a href="#cb26-134" aria-hidden="true" tabindex="-1"></a>sel <span class="ot">&lt;-</span> <span class="fu">vect</span>(nuts2_sel)</span>
<span id="cb26-135"><a href="#cb26-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-136"><a href="#cb26-136" aria-hidden="true" tabindex="-1"></a><span class="co"># Crop and mask the original layer to the region of interest</span></span>
<span id="cb26-137"><a href="#cb26-137" aria-hidden="true" tabindex="-1"></a>crop_JAN_D <span class="ot">&lt;-</span> <span class="fu">crop</span>(JAN_D, sel)</span>
<span id="cb26-138"><a href="#cb26-138" aria-hidden="true" tabindex="-1"></a>mask_JAN_D <span class="ot">&lt;-</span> <span class="fu">mask</span>(crop_JAN_D, sel)</span>
<span id="cb26-139"><a href="#cb26-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-140"><a href="#cb26-140" aria-hidden="true" tabindex="-1"></a><span class="co"># See result</span></span>
<span id="cb26-141"><a href="#cb26-141" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mask_JAN_D)</span>
<span id="cb26-142"><a href="#cb26-142" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-143"><a href="#cb26-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-144"><a href="#cb26-144" aria-hidden="true" tabindex="-1"></a>This raster is afterwards vectorized. We give an unique ID and a given column name for simplifying furtuer operation and merges. The map below shows the resulting output vectorized layer. </span>
<span id="cb26-145"><a href="#cb26-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-148"><a href="#cb26-148" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-149"><a href="#cb26-149" aria-hidden="true" tabindex="-1"></a><span class="co"># Vectorize result</span></span>
<span id="cb26-150"><a href="#cb26-150" aria-hidden="true" tabindex="-1"></a>JAN_D_sel <span class="ot">&lt;-</span> <span class="fu">as.points</span>(mask_JAN_D)</span>
<span id="cb26-151"><a href="#cb26-151" aria-hidden="true" tabindex="-1"></a>JAN_D_sel <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(JAN_D_sel)</span>
<span id="cb26-152"><a href="#cb26-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-153"><a href="#cb26-153" aria-hidden="true" tabindex="-1"></a><span class="co"># Harmonize column names</span></span>
<span id="cb26-154"><a href="#cb26-154" aria-hidden="true" tabindex="-1"></a>JAN_D_sel<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="fu">row.names</span>(JAN_D_sel)</span>
<span id="cb26-155"><a href="#cb26-155" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(JAN_D_sel)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"POP_JANV_D_2011"</span></span>
<span id="cb26-156"><a href="#cb26-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-157"><a href="#cb26-157" aria-hidden="true" tabindex="-1"></a><span class="co"># Map of values above 1</span></span>
<span id="cb26-158"><a href="#cb26-158" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> JAN_D_sel[JAN_D_sel<span class="sc">$</span>POP_JANV_D_2011 <span class="sc">&gt;</span> <span class="dv">1</span>,]</span>
<span id="cb26-159"><a href="#cb26-159" aria-hidden="true" tabindex="-1"></a>tmp2 <span class="ot">&lt;-</span> JAN_D_sel[JAN_D_sel<span class="sc">$</span>POP_JANV_D_2011 <span class="sc">&lt;</span> <span class="dv">1</span>,]</span>
<span id="cb26-160"><a href="#cb26-160" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(tmp2, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">col =</span> <span class="st">"lightgrey"</span>, <span class="at">cex =</span> .<span class="dv">6</span>, <span class="at">border =</span> <span class="cn">NA</span>) </span>
<span id="cb26-161"><a href="#cb26-161" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(tmp, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">var =</span> <span class="st">"POP_JANV_D_2011"</span>, <span class="at">type =</span> <span class="st">"choro"</span>, <span class="at">nbreaks =</span> <span class="dv">8</span>,</span>
<span id="cb26-162"><a href="#cb26-162" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">cex =</span> .<span class="dv">6</span>, <span class="at">add =</span> <span class="cn">TRUE</span>) </span>
<span id="cb26-163"><a href="#cb26-163" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-164"><a href="#cb26-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-165"><a href="#cb26-165" aria-hidden="true" tabindex="-1"></a>We implement a function to do all this stuff in a synthetic way. It allows to build vector layer for a reference input layer (the raw files) according to a region of interest. This is done for the layer with population in nightime in January (JAN_N) and daytime in August (AOU_D).</span>
<span id="cb26-166"><a href="#cb26-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-169"><a href="#cb26-169" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-170"><a href="#cb26-170" aria-hidden="true" tabindex="-1"></a>enact_extract <span class="ot">&lt;-</span> <span class="cf">function</span>(x, var_name, sel){</span>
<span id="cb26-171"><a href="#cb26-171" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reproject data</span></span>
<span id="cb26-172"><a href="#cb26-172" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">project</span>(<span class="at">x=</span> x, <span class="at">y =</span>  <span class="st">"EPSG:3035"</span>, <span class="at">method =</span> <span class="st">"bilinear"</span>)</span>
<span id="cb26-173"><a href="#cb26-173" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-174"><a href="#cb26-174" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter for a given region</span></span>
<span id="cb26-175"><a href="#cb26-175" aria-hidden="true" tabindex="-1"></a>  sel <span class="ot">&lt;-</span> <span class="fu">vect</span>(sel)</span>
<span id="cb26-176"><a href="#cb26-176" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-177"><a href="#cb26-177" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">crop</span>(x, sel)</span>
<span id="cb26-178"><a href="#cb26-178" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">mask</span>(x, sel)</span>
<span id="cb26-179"><a href="#cb26-179" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-180"><a href="#cb26-180" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Vectorize output</span></span>
<span id="cb26-181"><a href="#cb26-181" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.points</span>(x)</span>
<span id="cb26-182"><a href="#cb26-182" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(x)</span>
<span id="cb26-183"><a href="#cb26-183" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-184"><a href="#cb26-184" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Identifiers and colnames</span></span>
<span id="cb26-185"><a href="#cb26-185" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="fu">row.names</span>(x)</span>
<span id="cb26-186"><a href="#cb26-186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x)[<span class="dv">1</span>] <span class="ot">&lt;-</span> var_name</span>
<span id="cb26-187"><a href="#cb26-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb26-188"><a href="#cb26-188" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-189"><a href="#cb26-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-190"><a href="#cb26-190" aria-hidden="true" tabindex="-1"></a>JAN_N_sel <span class="ot">&lt;-</span> <span class="fu">enact_extract</span>(<span class="at">x =</span> JAN_N, <span class="at">sel =</span> nuts2_sel, <span class="at">var_name =</span> <span class="st">"POP_JANV_N_2011"</span>)</span>
<span id="cb26-191"><a href="#cb26-191" aria-hidden="true" tabindex="-1"></a>AOU_D_sel <span class="ot">&lt;-</span> <span class="fu">enact_extract</span>(<span class="at">x =</span> AOU_D, <span class="at">sel =</span> nuts2_sel, <span class="at">var_name =</span> <span class="st">"POP_AOU_D_2011"</span>)</span>
<span id="cb26-192"><a href="#cb26-192" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-193"><a href="#cb26-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-194"><a href="#cb26-194" aria-hidden="true" tabindex="-1"></a>These layers are merged to the first one. Data is prepared ! </span>
<span id="cb26-195"><a href="#cb26-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-198"><a href="#cb26-198" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-199"><a href="#cb26-199" aria-hidden="true" tabindex="-1"></a>JAN_N_sel <span class="ot">&lt;-</span><span class="fu">st_set_geometry</span>(JAN_N_sel, <span class="cn">NULL</span>)</span>
<span id="cb26-200"><a href="#cb26-200" aria-hidden="true" tabindex="-1"></a>AOU_D_sel <span class="ot">&lt;-</span><span class="fu">st_set_geometry</span>(AOU_D_sel, <span class="cn">NULL</span>)</span>
<span id="cb26-201"><a href="#cb26-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-202"><a href="#cb26-202" aria-hidden="true" tabindex="-1"></a>pt <span class="ot">&lt;-</span> <span class="fu">merge</span>(JAN_D_sel, JAN_N_sel[,,<span class="at">drop =</span> <span class="cn">TRUE</span>], <span class="at">by =</span> <span class="st">"ID"</span>)</span>
<span id="cb26-203"><a href="#cb26-203" aria-hidden="true" tabindex="-1"></a>pt <span class="ot">&lt;-</span> <span class="fu">merge</span>(pt, AOU_D_sel, <span class="at">by =</span> <span class="st">"ID"</span>)</span>
<span id="cb26-204"><a href="#cb26-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-205"><a href="#cb26-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-206"><a href="#cb26-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-207"><a href="#cb26-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-208"><a href="#cb26-208" aria-hidden="true" tabindex="-1"></a><span class="fu">##  Visualizations</span></span>
<span id="cb26-209"><a href="#cb26-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-210"><a href="#cb26-210" aria-hidden="true" tabindex="-1"></a><span class="fu">### Difference in daytime, by NUTS3</span></span>
<span id="cb26-211"><a href="#cb26-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-214"><a href="#cb26-214" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-215"><a href="#cb26-215" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only points covering the study area</span></span>
<span id="cb26-216"><a href="#cb26-216" aria-hidden="true" tabindex="-1"></a>pt_n3 <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(pt, nuts3_sel)</span>
<span id="cb26-217"><a href="#cb26-217" aria-hidden="true" tabindex="-1"></a>pt_n3 <span class="ot">&lt;-</span> <span class="fu">st_set_geometry</span>(pt_n3, <span class="cn">NULL</span>)</span>
<span id="cb26-218"><a href="#cb26-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-219"><a href="#cb26-219" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate results by NUTS3</span></span>
<span id="cb26-220"><a href="#cb26-220" aria-hidden="true" tabindex="-1"></a>n3 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(pt_n3[,<span class="fu">c</span>(<span class="st">"POP_JANV_D_2011"</span>,</span>
<span id="cb26-221"><a href="#cb26-221" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"POP_JANV_N_2011"</span>,</span>
<span id="cb26-222"><a href="#cb26-222" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"POP_AOU_D_2011"</span>)],</span>
<span id="cb26-223"><a href="#cb26-223" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="fu">list</span>(<span class="at">NAME_LATN =</span> pt_n3<span class="sc">$</span>NAME_LATN),</span>
<span id="cb26-224"><a href="#cb26-224" aria-hidden="true" tabindex="-1"></a>                <span class="at">FUN =</span> sum)</span>
<span id="cb26-225"><a href="#cb26-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-226"><a href="#cb26-226" aria-hidden="true" tabindex="-1"></a><span class="co"># Population in thousands</span></span>
<span id="cb26-227"><a href="#cb26-227" aria-hidden="true" tabindex="-1"></a>n3[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)] <span class="ot">&lt;-</span> n3[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)] <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb26-228"><a href="#cb26-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-229"><a href="#cb26-229" aria-hidden="true" tabindex="-1"></a><span class="co"># Barplot</span></span>
<span id="cb26-230"><a href="#cb26-230" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>), <span class="at">cex.main =</span> <span class="fl">0.9</span>, <span class="at">cex.lab =</span> <span class="fl">0.8</span>, <span class="at">cex.axis =</span> <span class="fl">0.7</span>)</span>
<span id="cb26-231"><a href="#cb26-231" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">cbind</span>(POP_JANV_D_2011,POP_JANV_N_2011) <span class="sc">~</span> NAME_LATN, <span class="at">data =</span> n3, <span class="at">beside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-232"><a href="#cb26-232" aria-hidden="true" tabindex="-1"></a>        <span class="at">border =</span> <span class="cn">FALSE</span>, <span class="at">las =</span> <span class="dv">2</span> , <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"#f7b26d"</span>, <span class="st">"#6d86f7"</span>), <span class="at">xlab =</span><span class="st">""</span>, <span class="at">axes =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-233"><a href="#cb26-233" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Population (Thousands)"</span>)</span>
<span id="cb26-234"><a href="#cb26-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-235"><a href="#cb26-235" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span> (<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Day"</span>,<span class="st">"Night"</span>),</span>
<span id="cb26-236"><a href="#cb26-236" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="fu">c</span>(<span class="st">"#f7b26d"</span>, <span class="st">"#6d86f7"</span>), <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">bg =</span> <span class="cn">NA</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb26-237"><a href="#cb26-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-238"><a href="#cb26-238" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Resident population, depending on the period of the day"</span>)</span>
<span id="cb26-239"><a href="#cb26-239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-240"><a href="#cb26-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-241"><a href="#cb26-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-242"><a href="#cb26-242" aria-hidden="true" tabindex="-1"></a>Population potentials for daytime and nightime are computed in a neighbourhood of 2000 meters. </span>
<span id="cb26-243"><a href="#cb26-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-244"><a href="#cb26-244" aria-hidden="true" tabindex="-1"></a>It requires first to create a regular grid with the extent of Ile-de-France. Then the <span class="in">`mcpotential`</span> function computes potentials on the basis of a distance matrix between the created grid (y) and the observed population (pt) in nightime and daytime. To understand more in detail the methodology behind and the core arguments (span, limit, beta), have a look to @giraud2022. </span>
<span id="cb26-245"><a href="#cb26-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-246"><a href="#cb26-246" aria-hidden="true" tabindex="-1"></a>Then, the 2 potential are divided and normalized in index 100. 100 corresponding to the population in nightime. Deciles of the resulting indicator are extracted to build polygons of equipotential from the regular grid of potential points. </span>
<span id="cb26-247"><a href="#cb26-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-250"><a href="#cb26-250" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-251"><a href="#cb26-251" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 1km reggular grid</span></span>
<span id="cb26-252"><a href="#cb26-252" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">create_grid</span>(<span class="at">x =</span> pt, <span class="at">res =</span> <span class="dv">1000</span>)</span>
<span id="cb26-253"><a href="#cb26-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-254"><a href="#cb26-254" aria-hidden="true" tabindex="-1"></a><span class="co"># Potential in a neighbourhood of 5000m</span></span>
<span id="cb26-255"><a href="#cb26-255" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>POT_JAN_D <span class="ot">&lt;-</span>  <span class="fu">mcpotential</span>(<span class="at">x =</span> pt, <span class="at">y =</span> y, <span class="at">var =</span> <span class="st">"POP_JANV_D_2011"</span>, <span class="at">fun =</span> <span class="st">"e"</span>,</span>
<span id="cb26-256"><a href="#cb26-256" aria-hidden="true" tabindex="-1"></a>                            <span class="at">span =</span> <span class="dv">2000</span>, <span class="at">limit =</span> <span class="dv">10000</span>, <span class="at">beta =</span> <span class="dv">2</span>)</span>
<span id="cb26-257"><a href="#cb26-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-258"><a href="#cb26-258" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>POT_JAN_N <span class="ot">&lt;-</span>  <span class="fu">mcpotential</span>(<span class="at">x =</span> pt, <span class="at">y =</span> y, <span class="at">var =</span> <span class="st">"POP_JANV_N_2011"</span>, <span class="at">fun =</span> <span class="st">"e"</span>,</span>
<span id="cb26-259"><a href="#cb26-259" aria-hidden="true" tabindex="-1"></a>                            <span class="at">span =</span> <span class="dv">2000</span>, <span class="at">limit =</span> <span class="dv">10000</span>, <span class="at">beta =</span> <span class="dv">2</span>)</span>
<span id="cb26-260"><a href="#cb26-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-261"><a href="#cb26-261" aria-hidden="true" tabindex="-1"></a><span class="co"># Resident population day / night</span></span>
<span id="cb26-262"><a href="#cb26-262" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>DIFF_D <span class="ot">&lt;-</span> y<span class="sc">$</span>POT_JAN_D <span class="sc">/</span> y<span class="sc">$</span>POT_JAN_N <span class="sc">*</span> <span class="dv">100</span> </span>
<span id="cb26-263"><a href="#cb26-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-264"><a href="#cb26-264" aria-hidden="true" tabindex="-1"></a><span class="co"># Quantiles 10, classes, covering the study area</span></span>
<span id="cb26-265"><a href="#cb26-265" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(y, nuts2_sel)</span>
<span id="cb26-266"><a href="#cb26-266" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">&lt;-</span> discr[,<span class="st">"DIFF_D"</span>, drop <span class="ot">=</span> <span class="cn">TRUE</span>]</span>
<span id="cb26-267"><a href="#cb26-267" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">&lt;-</span> <span class="fu">quantile</span>(discr, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-268"><a href="#cb26-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-269"><a href="#cb26-269" aria-hidden="true" tabindex="-1"></a><span class="co"># Equipotential</span></span>
<span id="cb26-270"><a href="#cb26-270" aria-hidden="true" tabindex="-1"></a>iso <span class="ot">&lt;-</span> <span class="fu">equipotential</span>(<span class="at">x =</span> y, <span class="at">var =</span> <span class="st">"DIFF_D"</span>, <span class="at">breaks =</span> discr, <span class="at">mask =</span> nuts2_sel)</span>
<span id="cb26-271"><a href="#cb26-271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-272"><a href="#cb26-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-273"><a href="#cb26-273" aria-hidden="true" tabindex="-1"></a>It allows to build a map. Separation between warm and cold colours corresponds to the class threshold the most closed to 100. 100 meaning equal population in nightime and daytime. </span>
<span id="cb26-274"><a href="#cb26-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-277"><a href="#cb26-277" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-278"><a href="#cb26-278" aria-hidden="true" tabindex="-1"></a><span class="co"># Diverging palette around 100</span></span>
<span id="cb26-279"><a href="#cb26-279" aria-hidden="true" tabindex="-1"></a>div <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">abs</span>(discr<span class="dv">-100</span>) <span class="sc">==</span> <span class="fu">min</span>(<span class="fu">abs</span>(discr<span class="dv">-100</span>)))</span>
<span id="cb26-280"><a href="#cb26-280" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> cols <span class="ot">&lt;-</span> <span class="fu">mf_get_pal</span>(<span class="at">n =</span> <span class="fu">c</span>(div<span class="dv">-1</span>, <span class="dv">11</span><span class="sc">-</span>div), <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"Purp"</span>, <span class="st">"YlOrRd"</span>))</span>
<span id="cb26-281"><a href="#cb26-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-282"><a href="#cb26-282" aria-hidden="true" tabindex="-1"></a><span class="co"># Map</span></span>
<span id="cb26-283"><a href="#cb26-283" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>))</span>
<span id="cb26-284"><a href="#cb26-284" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> iso, <span class="at">var =</span> <span class="st">"min"</span>, <span class="at">type =</span> <span class="st">"choro"</span>,</span>
<span id="cb26-285"><a href="#cb26-285" aria-hidden="true" tabindex="-1"></a>       <span class="at">breaks =</span> discr, <span class="at">pal =</span> pal, <span class="at">lwd =</span> .<span class="dv">2</span>, <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">leg_val_rnd =</span> <span class="dv">1</span>,</span>
<span id="cb26-286"><a href="#cb26-286" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_pos =</span> <span class="st">"topleft"</span>,</span>
<span id="cb26-287"><a href="#cb26-287" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_title =</span> <span class="fu">paste0</span>(<span class="st">"Difference in resident_population</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb26-288"><a href="#cb26-288" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Between the day and the night</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb26-289"><a href="#cb26-289" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"in 2011 (100 = resident population at night)"</span>))</span>
<span id="cb26-290"><a href="#cb26-290" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-291"><a href="#cb26-291" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> nuts3_sel, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-292"><a href="#cb26-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-293"><a href="#cb26-293" aria-hidden="true" tabindex="-1"></a>tiles_front <span class="ot">&lt;-</span> <span class="fu">get_tiles</span>(nuts2_sel, <span class="at">crop =</span> <span class="cn">TRUE</span>, <span class="at">provider =</span> <span class="st">"CartoDB.PositronOnlyLabels"</span>, <span class="at">zoom =</span> <span class="dv">9</span>)</span>
<span id="cb26-294"><a href="#cb26-294" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_tiles</span>(tiles_front, <span class="at">add =</span> <span class="cn">TRUE</span>)  </span>
<span id="cb26-295"><a href="#cb26-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-296"><a href="#cb26-296" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_layout</span>(<span class="at">title =</span> <span class="st">"Resident population - daytime difference"</span>, </span>
<span id="cb26-297"><a href="#cb26-297" aria-hidden="true" tabindex="-1"></a>          <span class="at">credits =</span> <span class="fu">paste0</span>(<span class="st">"Realisation : Ronan Ysebaert, 2023"</span>,</span>
<span id="cb26-298"><a href="#cb26-298" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Data source : ENACT-POP (Global Human Settlement Layer, JRC, European Commission, 2023"</span>),</span>
<span id="cb26-299"><a href="#cb26-299" aria-hidden="true" tabindex="-1"></a>          <span class="at">arrow =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-300"><a href="#cb26-300" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-301"><a href="#cb26-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-302"><a href="#cb26-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-303"><a href="#cb26-303" aria-hidden="true" tabindex="-1"></a><span class="fu">### Seasonal trend</span></span>
<span id="cb26-304"><a href="#cb26-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-307"><a href="#cb26-307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-308"><a href="#cb26-308" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>), <span class="at">cex.main =</span> <span class="fl">0.9</span>, <span class="at">cex.lab =</span> <span class="fl">0.8</span>, <span class="at">cex.axis =</span> <span class="fl">0.7</span>)</span>
<span id="cb26-309"><a href="#cb26-309" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">cbind</span>(POP_JANV_D_2011,POP_AOU_D_2011) <span class="sc">~</span> NAME_LATN, <span class="at">data =</span> n3, <span class="at">beside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-310"><a href="#cb26-310" aria-hidden="true" tabindex="-1"></a>        <span class="at">border =</span> <span class="cn">FALSE</span>, <span class="at">las =</span> <span class="dv">2</span> , <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"#6bc982"</span>, <span class="st">"#ff697a"</span>), <span class="at">xlab =</span><span class="st">""</span>, <span class="at">axes =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-311"><a href="#cb26-311" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Population (Thousands)"</span>)</span>
<span id="cb26-312"><a href="#cb26-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-313"><a href="#cb26-313" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span> (<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"January"</span>,<span class="st">"August"</span>),</span>
<span id="cb26-314"><a href="#cb26-314" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="fu">c</span>(<span class="st">"#6bc982"</span>, <span class="st">"#ff697a"</span>), <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">bg =</span> <span class="cn">NA</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb26-315"><a href="#cb26-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-316"><a href="#cb26-316" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Resident population, depending on the season"</span>)</span>
<span id="cb26-317"><a href="#cb26-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-318"><a href="#cb26-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-319"><a href="#cb26-319" aria-hidden="true" tabindex="-1"></a>For the seasonal trend we look into the absolute difference between population in January and August. The resulting picture is not exactly the same than the previous map as it highlights the population gain / loss over the seasons. </span>
<span id="cb26-320"><a href="#cb26-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-323"><a href="#cb26-323" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-324"><a href="#cb26-324" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute potential</span></span>
<span id="cb26-325"><a href="#cb26-325" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>POT_AOU_D <span class="ot">&lt;-</span>  <span class="fu">mcpotential</span>(<span class="at">x =</span> pt, <span class="at">y =</span> y, <span class="at">var =</span> <span class="st">"POP_AOU_D_2011"</span>, <span class="at">fun =</span> <span class="st">"e"</span>,</span>
<span id="cb26-326"><a href="#cb26-326" aria-hidden="true" tabindex="-1"></a>                            <span class="at">span =</span> <span class="dv">2000</span>, <span class="at">limit =</span> <span class="dv">10000</span>, <span class="at">beta =</span> <span class="dv">2</span>)</span>
<span id="cb26-327"><a href="#cb26-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-328"><a href="#cb26-328" aria-hidden="true" tabindex="-1"></a><span class="co"># Resident population day / night</span></span>
<span id="cb26-329"><a href="#cb26-329" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>DIFF_D <span class="ot">&lt;-</span>  y<span class="sc">$</span>POT_AOU_D <span class="sc">-</span> y<span class="sc">$</span>POT_JAN_D</span>
<span id="cb26-330"><a href="#cb26-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-331"><a href="#cb26-331" aria-hidden="true" tabindex="-1"></a><span class="co"># Quantiles 10, classes, covering the study area</span></span>
<span id="cb26-332"><a href="#cb26-332" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(y, nuts2_sel)</span>
<span id="cb26-333"><a href="#cb26-333" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">&lt;-</span> discr[,<span class="st">"DIFF_D"</span>, drop <span class="ot">=</span> <span class="cn">TRUE</span>]</span>
<span id="cb26-334"><a href="#cb26-334" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">&lt;-</span> <span class="fu">quantile</span>(discr, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-335"><a href="#cb26-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-336"><a href="#cb26-336" aria-hidden="true" tabindex="-1"></a><span class="co"># Diverging palette around 100</span></span>
<span id="cb26-337"><a href="#cb26-337" aria-hidden="true" tabindex="-1"></a>div <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">abs</span>(discr<span class="dv">-100</span>) <span class="sc">==</span> <span class="fu">min</span>(<span class="fu">abs</span>(discr<span class="dv">-100</span>)))</span>
<span id="cb26-338"><a href="#cb26-338" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> cols <span class="ot">&lt;-</span> <span class="fu">mf_get_pal</span>(<span class="at">n =</span> <span class="fu">c</span>(div<span class="dv">-1</span>, <span class="dv">11</span><span class="sc">-</span>div), <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"Reds 3"</span>, <span class="st">"Greens 3"</span>))</span>
<span id="cb26-339"><a href="#cb26-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-340"><a href="#cb26-340" aria-hidden="true" tabindex="-1"></a><span class="co"># Equipotential</span></span>
<span id="cb26-341"><a href="#cb26-341" aria-hidden="true" tabindex="-1"></a>iso <span class="ot">&lt;-</span> <span class="fu">equipotential</span>(<span class="at">x =</span> y, <span class="at">var =</span> <span class="st">"DIFF_D"</span>, <span class="at">breaks =</span> discr, <span class="at">mask =</span> nuts2_sel)</span>
<span id="cb26-342"><a href="#cb26-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-343"><a href="#cb26-343" aria-hidden="true" tabindex="-1"></a><span class="co"># Map</span></span>
<span id="cb26-344"><a href="#cb26-344" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>))</span>
<span id="cb26-345"><a href="#cb26-345" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> iso, <span class="at">var =</span> <span class="st">"min"</span>, <span class="at">type =</span> <span class="st">"choro"</span>,</span>
<span id="cb26-346"><a href="#cb26-346" aria-hidden="true" tabindex="-1"></a>       <span class="at">breaks =</span> discr, <span class="at">pal =</span> pal, <span class="at">lwd =</span> .<span class="dv">2</span>, <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">leg_val_rnd =</span> <span class="dv">1</span>,</span>
<span id="cb26-347"><a href="#cb26-347" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_pos =</span> <span class="st">"topleft"</span>,</span>
<span id="cb26-348"><a href="#cb26-348" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_title =</span> <span class="fu">paste0</span>(<span class="st">"Difference in resident_population</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb26-349"><a href="#cb26-349" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Between August and January"</span>))</span>
<span id="cb26-350"><a href="#cb26-350" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> nuts3_sel, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-351"><a href="#cb26-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-352"><a href="#cb26-352" aria-hidden="true" tabindex="-1"></a>tiles_front <span class="ot">&lt;-</span> <span class="fu">get_tiles</span>(nuts2_sel, <span class="at">crop =</span> <span class="cn">TRUE</span>, <span class="at">provider =</span> <span class="st">"CartoDB.PositronOnlyLabels"</span>, <span class="at">zoom =</span> <span class="dv">9</span>)</span>
<span id="cb26-353"><a href="#cb26-353" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_tiles</span>(tiles_front, <span class="at">add =</span> <span class="cn">TRUE</span>)  </span>
<span id="cb26-354"><a href="#cb26-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-355"><a href="#cb26-355" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_layout</span>(<span class="at">title =</span> <span class="st">"Resident population - seasonal difference"</span>, </span>
<span id="cb26-356"><a href="#cb26-356" aria-hidden="true" tabindex="-1"></a>          <span class="at">credits =</span> <span class="fu">paste0</span>(<span class="st">"Realisation : Ronan Ysebaert, 2023</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb26-357"><a href="#cb26-357" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Data source : ENACT-POP (Global Human Settlement Layer, JRC, European Commission, 2023"</span>),</span>
<span id="cb26-358"><a href="#cb26-358" aria-hidden="true" tabindex="-1"></a>          <span class="at">arrow =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-359"><a href="#cb26-359" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-360"><a href="#cb26-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-361"><a href="#cb26-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-362"><a href="#cb26-362" aria-hidden="true" tabindex="-1"></a><span class="fu"># London (UK)</span></span>
<span id="cb26-363"><a href="#cb26-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-364"><a href="#cb26-364" aria-hidden="true" tabindex="-1"></a>Adapting this methodological framework to other regions is afterwards quite easy. Let's analyse the situation in London between daytime and nightime in January... </span>
<span id="cb26-365"><a href="#cb26-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-368"><a href="#cb26-368" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-369"><a href="#cb26-369" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb26-370"><a href="#cb26-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-371"><a href="#cb26-371" aria-hidden="true" tabindex="-1"></a>nuts_code <span class="ot">&lt;-</span> <span class="st">"UKI"</span></span>
<span id="cb26-372"><a href="#cb26-372" aria-hidden="true" tabindex="-1"></a>nuts1_sel <span class="ot">&lt;-</span> nuts1[nuts1<span class="sc">$</span>NUTS_ID <span class="sc">==</span> nuts_code,]</span>
<span id="cb26-373"><a href="#cb26-373" aria-hidden="true" tabindex="-1"></a>nuts3_sel <span class="ot">&lt;-</span> nuts3[<span class="fu">substr</span>(nuts3<span class="sc">$</span>NUTS_ID, <span class="dv">1</span>, <span class="dv">3</span>) <span class="sc">==</span> nuts_code,]</span>
<span id="cb26-374"><a href="#cb26-374" aria-hidden="true" tabindex="-1"></a>sel <span class="ot">&lt;-</span> <span class="fu">vect</span>(nuts1_sel)</span>
<span id="cb26-375"><a href="#cb26-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-376"><a href="#cb26-376" aria-hidden="true" tabindex="-1"></a>JAN_N_sel <span class="ot">&lt;-</span> <span class="fu">enact_extract</span>(<span class="at">x =</span> JAN_N, <span class="at">sel =</span> nuts1_sel, <span class="at">var_name =</span> <span class="st">"POP_JANV_N_2011"</span>)</span>
<span id="cb26-377"><a href="#cb26-377" aria-hidden="true" tabindex="-1"></a>JAN_D_sel <span class="ot">&lt;-</span> <span class="fu">enact_extract</span>(<span class="at">x =</span> JAN_D, <span class="at">sel =</span> nuts1_sel, <span class="at">var_name =</span> <span class="st">"POP_JANV_D_2011"</span>)</span>
<span id="cb26-378"><a href="#cb26-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-379"><a href="#cb26-379" aria-hidden="true" tabindex="-1"></a>JAN_N_sel <span class="ot">&lt;-</span><span class="fu">st_set_geometry</span>(JAN_N_sel, <span class="cn">NULL</span>)</span>
<span id="cb26-380"><a href="#cb26-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-381"><a href="#cb26-381" aria-hidden="true" tabindex="-1"></a>pt <span class="ot">&lt;-</span> <span class="fu">merge</span>(JAN_D_sel, JAN_N_sel[,,<span class="at">drop =</span> <span class="cn">TRUE</span>], <span class="at">by =</span> <span class="st">"ID"</span>)</span>
<span id="cb26-382"><a href="#cb26-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-383"><a href="#cb26-383" aria-hidden="true" tabindex="-1"></a>pt_n3 <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(pt, nuts3_sel)</span>
<span id="cb26-384"><a href="#cb26-384" aria-hidden="true" tabindex="-1"></a>pt_n3 <span class="ot">&lt;-</span> <span class="fu">st_set_geometry</span>(pt_n3, <span class="cn">NULL</span>)</span>
<span id="cb26-385"><a href="#cb26-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-386"><a href="#cb26-386" aria-hidden="true" tabindex="-1"></a>n3 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(pt_n3[,<span class="fu">c</span>(<span class="st">"POP_JANV_D_2011"</span>,</span>
<span id="cb26-387"><a href="#cb26-387" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"POP_JANV_N_2011"</span>)],</span>
<span id="cb26-388"><a href="#cb26-388" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="fu">list</span>(<span class="at">NAME_LATN =</span> pt_n3<span class="sc">$</span>NAME_LATN),</span>
<span id="cb26-389"><a href="#cb26-389" aria-hidden="true" tabindex="-1"></a>                <span class="at">FUN =</span> sum)</span>
<span id="cb26-390"><a href="#cb26-390" aria-hidden="true" tabindex="-1"></a>n3[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)] <span class="ot">&lt;-</span> n3[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)] <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb26-391"><a href="#cb26-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-392"><a href="#cb26-392" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>), <span class="at">cex.main =</span> <span class="fl">0.9</span>, <span class="at">cex.lab =</span> <span class="fl">0.8</span>, <span class="at">cex.axis =</span> <span class="fl">0.7</span>)</span>
<span id="cb26-393"><a href="#cb26-393" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">cbind</span>(POP_JANV_D_2011,POP_JANV_N_2011) <span class="sc">~</span> NAME_LATN, <span class="at">data =</span> n3, <span class="at">beside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-394"><a href="#cb26-394" aria-hidden="true" tabindex="-1"></a>        <span class="at">border =</span> <span class="cn">FALSE</span>, <span class="at">las =</span> <span class="dv">2</span> , <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"#f7b26d"</span>, <span class="st">"#6d86f7"</span>), <span class="at">xlab =</span><span class="st">""</span>, <span class="at">axes =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-395"><a href="#cb26-395" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Population (Thousands)"</span>)</span>
<span id="cb26-396"><a href="#cb26-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-397"><a href="#cb26-397" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span> (<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Day"</span>,<span class="st">"Night"</span>),</span>
<span id="cb26-398"><a href="#cb26-398" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="fu">c</span>(<span class="st">"#f7b26d"</span>, <span class="st">"#6d86f7"</span>), <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">bg =</span> <span class="cn">NA</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb26-399"><a href="#cb26-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-400"><a href="#cb26-400" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Resident population, depending on the period of the day"</span>)</span>
<span id="cb26-401"><a href="#cb26-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-402"><a href="#cb26-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-403"><a href="#cb26-403" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 1km reggular grid</span></span>
<span id="cb26-404"><a href="#cb26-404" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">create_grid</span>(<span class="at">x =</span> pt, <span class="at">res =</span> <span class="dv">1000</span>)</span>
<span id="cb26-405"><a href="#cb26-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-406"><a href="#cb26-406" aria-hidden="true" tabindex="-1"></a><span class="co"># Potential in a neighbourhood of 5000m</span></span>
<span id="cb26-407"><a href="#cb26-407" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>POT_JAN_D <span class="ot">&lt;-</span>  <span class="fu">mcpotential</span>(<span class="at">x =</span> pt, <span class="at">y =</span> y, <span class="at">var =</span> <span class="st">"POP_JANV_D_2011"</span>, <span class="at">fun =</span> <span class="st">"e"</span>,</span>
<span id="cb26-408"><a href="#cb26-408" aria-hidden="true" tabindex="-1"></a>                            <span class="at">span =</span> <span class="dv">2000</span>, <span class="at">limit =</span> <span class="dv">10000</span>, <span class="at">beta =</span> <span class="dv">2</span>)</span>
<span id="cb26-409"><a href="#cb26-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-410"><a href="#cb26-410" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>POT_JAN_N <span class="ot">&lt;-</span>  <span class="fu">mcpotential</span>(<span class="at">x =</span> pt, <span class="at">y =</span> y, <span class="at">var =</span> <span class="st">"POP_JANV_N_2011"</span>, <span class="at">fun =</span> <span class="st">"e"</span>,</span>
<span id="cb26-411"><a href="#cb26-411" aria-hidden="true" tabindex="-1"></a>                            <span class="at">span =</span> <span class="dv">2000</span>, <span class="at">limit =</span> <span class="dv">10000</span>, <span class="at">beta =</span> <span class="dv">2</span>)</span>
<span id="cb26-412"><a href="#cb26-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-413"><a href="#cb26-413" aria-hidden="true" tabindex="-1"></a><span class="co"># Resident population day / night</span></span>
<span id="cb26-414"><a href="#cb26-414" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>DIFF_D <span class="ot">&lt;-</span> y<span class="sc">$</span>POT_JAN_D <span class="sc">/</span> y<span class="sc">$</span>POT_JAN_N <span class="sc">*</span> <span class="dv">100</span> </span>
<span id="cb26-415"><a href="#cb26-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-416"><a href="#cb26-416" aria-hidden="true" tabindex="-1"></a><span class="co"># Quantiles 10, classes, covering the study area</span></span>
<span id="cb26-417"><a href="#cb26-417" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(y, nuts1_sel)</span>
<span id="cb26-418"><a href="#cb26-418" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">&lt;-</span> discr[,<span class="st">"DIFF_D"</span>, drop <span class="ot">=</span> <span class="cn">TRUE</span>]</span>
<span id="cb26-419"><a href="#cb26-419" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">&lt;-</span> <span class="fu">quantile</span>(discr, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-420"><a href="#cb26-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-421"><a href="#cb26-421" aria-hidden="true" tabindex="-1"></a><span class="co"># Diverging palette around 100</span></span>
<span id="cb26-422"><a href="#cb26-422" aria-hidden="true" tabindex="-1"></a>div <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">abs</span>(discr<span class="dv">-100</span>) <span class="sc">==</span> <span class="fu">min</span>(<span class="fu">abs</span>(discr<span class="dv">-100</span>)))</span>
<span id="cb26-423"><a href="#cb26-423" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> cols <span class="ot">&lt;-</span> <span class="fu">mf_get_pal</span>(<span class="at">n =</span> <span class="fu">c</span>(div<span class="dv">-1</span>, <span class="dv">11</span><span class="sc">-</span>div), <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"Purp"</span>, <span class="st">"YlOrRd"</span>))</span>
<span id="cb26-424"><a href="#cb26-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-425"><a href="#cb26-425" aria-hidden="true" tabindex="-1"></a><span class="co"># Equipotential</span></span>
<span id="cb26-426"><a href="#cb26-426" aria-hidden="true" tabindex="-1"></a>iso <span class="ot">&lt;-</span> <span class="fu">equipotential</span>(<span class="at">x =</span> y, <span class="at">var =</span> <span class="st">"DIFF_D"</span>, <span class="at">breaks =</span> discr, <span class="at">mask =</span> nuts1_sel)</span>
<span id="cb26-427"><a href="#cb26-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-428"><a href="#cb26-428" aria-hidden="true" tabindex="-1"></a><span class="co"># Map</span></span>
<span id="cb26-429"><a href="#cb26-429" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>))</span>
<span id="cb26-430"><a href="#cb26-430" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> iso, <span class="at">var =</span> <span class="st">"min"</span>, <span class="at">type =</span> <span class="st">"choro"</span>,</span>
<span id="cb26-431"><a href="#cb26-431" aria-hidden="true" tabindex="-1"></a>       <span class="at">breaks =</span> discr, <span class="at">pal =</span> pal, <span class="at">lwd =</span> .<span class="dv">2</span>, <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">leg_val_rnd =</span> <span class="dv">1</span>,</span>
<span id="cb26-432"><a href="#cb26-432" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_pos =</span> <span class="st">"topleft"</span>,</span>
<span id="cb26-433"><a href="#cb26-433" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_title =</span> <span class="fu">paste0</span>(<span class="st">"Difference in resident_population</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb26-434"><a href="#cb26-434" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Between the day and the night</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb26-435"><a href="#cb26-435" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"in 2011 (100 = resident population at night)"</span>))</span>
<span id="cb26-436"><a href="#cb26-436" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-437"><a href="#cb26-437" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> nuts3_sel, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-438"><a href="#cb26-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-439"><a href="#cb26-439" aria-hidden="true" tabindex="-1"></a>tiles_front <span class="ot">&lt;-</span> <span class="fu">get_tiles</span>(nuts1_sel, <span class="at">crop =</span> <span class="cn">TRUE</span>, <span class="at">provider =</span> <span class="st">"CartoDB.PositronOnlyLabels"</span>, <span class="at">zoom =</span> <span class="dv">10</span>)</span>
<span id="cb26-440"><a href="#cb26-440" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_tiles</span>(tiles_front, <span class="at">add =</span> <span class="cn">TRUE</span>)  </span>
<span id="cb26-441"><a href="#cb26-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-442"><a href="#cb26-442" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_layout</span>(<span class="at">title =</span> <span class="st">"Resident population - daytime difference"</span>, </span>
<span id="cb26-443"><a href="#cb26-443" aria-hidden="true" tabindex="-1"></a>          <span class="at">credits =</span> <span class="fu">paste0</span>(<span class="st">"Realisation : Ronan Ysebaert, 2023</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb26-444"><a href="#cb26-444" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Data source : ENACT-POP (Global Human Settlement Layer, JRC, European Commission, 2023"</span>),</span>
<span id="cb26-445"><a href="#cb26-445" aria-hidden="true" tabindex="-1"></a>          <span class="at">arrow =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-446"><a href="#cb26-446" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-447"><a href="#cb26-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-448"><a href="#cb26-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-449"><a href="#cb26-449" aria-hidden="true" tabindex="-1"></a><span class="fu"># Auvergne-Rhône-Alpes (FR)</span></span>
<span id="cb26-450"><a href="#cb26-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-451"><a href="#cb26-451" aria-hidden="true" tabindex="-1"></a>... Or in Auvergne-Rhônes-Alpes region in France between January and August. The span of the Stewart's potential has been enlarged to 5000 meters instead of 2000 meters to observe more general trends. </span>
<span id="cb26-452"><a href="#cb26-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-455"><a href="#cb26-455" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-456"><a href="#cb26-456" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb26-457"><a href="#cb26-457" aria-hidden="true" tabindex="-1"></a>nuts_code <span class="ot">&lt;-</span> <span class="st">"FRK"</span></span>
<span id="cb26-458"><a href="#cb26-458" aria-hidden="true" tabindex="-1"></a>nuts1_sel <span class="ot">&lt;-</span> nuts1[nuts1<span class="sc">$</span>NUTS_ID <span class="sc">==</span> nuts_code,]</span>
<span id="cb26-459"><a href="#cb26-459" aria-hidden="true" tabindex="-1"></a>nuts3_sel <span class="ot">&lt;-</span> nuts3[<span class="fu">substr</span>(nuts3<span class="sc">$</span>NUTS_ID, <span class="dv">1</span>, <span class="dv">3</span>) <span class="sc">==</span> nuts_code,]</span>
<span id="cb26-460"><a href="#cb26-460" aria-hidden="true" tabindex="-1"></a>sel <span class="ot">&lt;-</span> <span class="fu">vect</span>(nuts1_sel)</span>
<span id="cb26-461"><a href="#cb26-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-462"><a href="#cb26-462" aria-hidden="true" tabindex="-1"></a>JAN_N_sel <span class="ot">&lt;-</span> <span class="fu">enact_extract</span>(<span class="at">x =</span> JAN_N, <span class="at">sel =</span> nuts3_sel, <span class="at">var_name =</span> <span class="st">"POP_JANV_N_2011"</span>)</span>
<span id="cb26-463"><a href="#cb26-463" aria-hidden="true" tabindex="-1"></a>JAN_D_sel <span class="ot">&lt;-</span> <span class="fu">enact_extract</span>(<span class="at">x =</span> JAN_D, <span class="at">sel =</span> nuts3_sel, <span class="at">var_name =</span> <span class="st">"POP_JANV_D_2011"</span>)</span>
<span id="cb26-464"><a href="#cb26-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-465"><a href="#cb26-465" aria-hidden="true" tabindex="-1"></a>JAN_N_sel <span class="ot">&lt;-</span><span class="fu">st_set_geometry</span>(JAN_N_sel, <span class="cn">NULL</span>)</span>
<span id="cb26-466"><a href="#cb26-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-467"><a href="#cb26-467" aria-hidden="true" tabindex="-1"></a>pt <span class="ot">&lt;-</span> <span class="fu">merge</span>(JAN_D_sel, JAN_N_sel, <span class="at">by =</span> <span class="st">"ID"</span>)</span>
<span id="cb26-468"><a href="#cb26-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-469"><a href="#cb26-469" aria-hidden="true" tabindex="-1"></a>pt_n3 <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(pt, nuts3_sel)</span>
<span id="cb26-470"><a href="#cb26-470" aria-hidden="true" tabindex="-1"></a>pt_n3 <span class="ot">&lt;-</span> <span class="fu">st_set_geometry</span>(pt_n3, <span class="cn">NULL</span>)</span>
<span id="cb26-471"><a href="#cb26-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-472"><a href="#cb26-472" aria-hidden="true" tabindex="-1"></a>n3 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(pt_n3[,<span class="fu">c</span>(<span class="st">"POP_JANV_D_2011"</span>,</span>
<span id="cb26-473"><a href="#cb26-473" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"POP_JANV_N_2011"</span>)],</span>
<span id="cb26-474"><a href="#cb26-474" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="fu">list</span>(<span class="at">NAME_LATN =</span> pt_n3<span class="sc">$</span>NAME_LATN),</span>
<span id="cb26-475"><a href="#cb26-475" aria-hidden="true" tabindex="-1"></a>                <span class="at">FUN =</span> sum)</span>
<span id="cb26-476"><a href="#cb26-476" aria-hidden="true" tabindex="-1"></a>n3[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)] <span class="ot">&lt;-</span> n3[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)] <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb26-477"><a href="#cb26-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-478"><a href="#cb26-478" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>), <span class="at">cex.main =</span> <span class="fl">0.9</span>, <span class="at">cex.lab =</span> <span class="fl">0.8</span>, <span class="at">cex.axis =</span> <span class="fl">0.7</span>)</span>
<span id="cb26-479"><a href="#cb26-479" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">cbind</span>(POP_JANV_D_2011,POP_JANV_N_2011) <span class="sc">~</span> NAME_LATN, <span class="at">data =</span> n3, <span class="at">beside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-480"><a href="#cb26-480" aria-hidden="true" tabindex="-1"></a>        <span class="at">border =</span> <span class="cn">FALSE</span>, <span class="at">las =</span> <span class="dv">2</span> , <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"#f7b26d"</span>, <span class="st">"#6d86f7"</span>), <span class="at">xlab =</span><span class="st">""</span>, <span class="at">axes =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-481"><a href="#cb26-481" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Population (Thousands)"</span>)</span>
<span id="cb26-482"><a href="#cb26-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-483"><a href="#cb26-483" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span> (<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Day"</span>,<span class="st">"Night"</span>),</span>
<span id="cb26-484"><a href="#cb26-484" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="fu">c</span>(<span class="st">"#f7b26d"</span>, <span class="st">"#6d86f7"</span>), <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">bg =</span> <span class="cn">NA</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb26-485"><a href="#cb26-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-486"><a href="#cb26-486" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Resident population, depending on the period of the day"</span>)</span>
<span id="cb26-487"><a href="#cb26-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-488"><a href="#cb26-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-489"><a href="#cb26-489" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 1km reggular grid</span></span>
<span id="cb26-490"><a href="#cb26-490" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">create_grid</span>(<span class="at">x =</span> pt, <span class="at">res =</span> <span class="dv">1000</span>)</span>
<span id="cb26-491"><a href="#cb26-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-492"><a href="#cb26-492" aria-hidden="true" tabindex="-1"></a><span class="co"># Potential in a neighbourhood of 5000m</span></span>
<span id="cb26-493"><a href="#cb26-493" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>POT_JAN_D <span class="ot">&lt;-</span>  <span class="fu">mcpotential</span>(<span class="at">x =</span> pt, <span class="at">y =</span> y, <span class="at">var =</span> <span class="st">"POP_JANV_D_2011"</span>, <span class="at">fun =</span> <span class="st">"e"</span>,</span>
<span id="cb26-494"><a href="#cb26-494" aria-hidden="true" tabindex="-1"></a>                            <span class="at">span =</span> <span class="dv">5000</span>, <span class="at">limit =</span> <span class="dv">10000</span>, <span class="at">beta =</span> <span class="dv">2</span>)</span>
<span id="cb26-495"><a href="#cb26-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-496"><a href="#cb26-496" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>POT_JAN_N <span class="ot">&lt;-</span>  <span class="fu">mcpotential</span>(<span class="at">x =</span> pt, <span class="at">y =</span> y, <span class="at">var =</span> <span class="st">"POP_JANV_N_2011"</span>, <span class="at">fun =</span> <span class="st">"e"</span>,</span>
<span id="cb26-497"><a href="#cb26-497" aria-hidden="true" tabindex="-1"></a>                            <span class="at">span =</span> <span class="dv">5000</span>, <span class="at">limit =</span> <span class="dv">10000</span>, <span class="at">beta =</span> <span class="dv">2</span>)</span>
<span id="cb26-498"><a href="#cb26-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-499"><a href="#cb26-499" aria-hidden="true" tabindex="-1"></a><span class="co"># Resident population day / night</span></span>
<span id="cb26-500"><a href="#cb26-500" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>DIFF_D <span class="ot">&lt;-</span> y<span class="sc">$</span>POT_JAN_D <span class="sc">/</span> y<span class="sc">$</span>POT_JAN_N <span class="sc">*</span> <span class="dv">100</span> </span>
<span id="cb26-501"><a href="#cb26-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-502"><a href="#cb26-502" aria-hidden="true" tabindex="-1"></a><span class="co"># Quantiles 10, classes, covering the study area</span></span>
<span id="cb26-503"><a href="#cb26-503" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(y, nuts3_sel)</span>
<span id="cb26-504"><a href="#cb26-504" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">&lt;-</span> discr[,<span class="st">"DIFF_D"</span>, drop <span class="ot">=</span> <span class="cn">TRUE</span>]</span>
<span id="cb26-505"><a href="#cb26-505" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">&lt;-</span> <span class="fu">quantile</span>(discr, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-506"><a href="#cb26-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-507"><a href="#cb26-507" aria-hidden="true" tabindex="-1"></a><span class="co"># Diverging palette around 100</span></span>
<span id="cb26-508"><a href="#cb26-508" aria-hidden="true" tabindex="-1"></a>div <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">abs</span>(discr<span class="dv">-100</span>) <span class="sc">==</span> <span class="fu">min</span>(<span class="fu">abs</span>(discr<span class="dv">-100</span>)))</span>
<span id="cb26-509"><a href="#cb26-509" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> cols <span class="ot">&lt;-</span> <span class="fu">mf_get_pal</span>(<span class="at">n =</span> <span class="fu">c</span>(div<span class="dv">-1</span>, <span class="dv">11</span><span class="sc">-</span>div), <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"Purp"</span>, <span class="st">"YlOrRd"</span>))</span>
<span id="cb26-510"><a href="#cb26-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-511"><a href="#cb26-511" aria-hidden="true" tabindex="-1"></a><span class="co"># Equipotential</span></span>
<span id="cb26-512"><a href="#cb26-512" aria-hidden="true" tabindex="-1"></a>iso <span class="ot">&lt;-</span> <span class="fu">equipotential</span>(<span class="at">x =</span> y, <span class="at">var =</span> <span class="st">"DIFF_D"</span>, <span class="at">breaks =</span> discr, <span class="at">mask =</span> nuts3_sel)</span>
<span id="cb26-513"><a href="#cb26-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-514"><a href="#cb26-514" aria-hidden="true" tabindex="-1"></a><span class="co"># Map</span></span>
<span id="cb26-515"><a href="#cb26-515" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>))</span>
<span id="cb26-516"><a href="#cb26-516" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> iso, <span class="at">var =</span> <span class="st">"min"</span>, <span class="at">type =</span> <span class="st">"choro"</span>,</span>
<span id="cb26-517"><a href="#cb26-517" aria-hidden="true" tabindex="-1"></a>       <span class="at">breaks =</span> discr, <span class="at">pal =</span> pal, <span class="at">lwd =</span> .<span class="dv">2</span>, <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">leg_val_rnd =</span> <span class="dv">1</span>,</span>
<span id="cb26-518"><a href="#cb26-518" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_pos =</span> <span class="st">"topleft"</span>,</span>
<span id="cb26-519"><a href="#cb26-519" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_title =</span> <span class="fu">paste0</span>(<span class="st">"Difference in resident_population</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb26-520"><a href="#cb26-520" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Between the day and the night</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb26-521"><a href="#cb26-521" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"in 2011 (100 = resident population at night)"</span>))</span>
<span id="cb26-522"><a href="#cb26-522" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-523"><a href="#cb26-523" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> nuts3_sel, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-524"><a href="#cb26-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-525"><a href="#cb26-525" aria-hidden="true" tabindex="-1"></a>tiles_front <span class="ot">&lt;-</span> <span class="fu">get_tiles</span>(nuts3_sel, <span class="at">crop =</span> <span class="cn">TRUE</span>, <span class="at">provider =</span> <span class="st">"CartoDB.PositronOnlyLabels"</span>, <span class="at">zoom =</span> <span class="dv">8</span>)</span>
<span id="cb26-526"><a href="#cb26-526" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_tiles</span>(tiles_front, <span class="at">add =</span> <span class="cn">TRUE</span>)  </span>
<span id="cb26-527"><a href="#cb26-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-528"><a href="#cb26-528" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_layout</span>(<span class="at">title =</span> <span class="st">"Resident population - daytime difference"</span>, </span>
<span id="cb26-529"><a href="#cb26-529" aria-hidden="true" tabindex="-1"></a>          <span class="at">credits =</span> <span class="fu">paste0</span>(<span class="st">"Realisation : Ronan Ysebaert, 2023</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb26-530"><a href="#cb26-530" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Data source : ENACT-POP (Global Human Settlement Layer, JRC, European Commission, 2023"</span>),</span>
<span id="cb26-531"><a href="#cb26-531" aria-hidden="true" tabindex="-1"></a>          <span class="at">arrow =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-532"><a href="#cb26-532" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-533"><a href="#cb26-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-534"><a href="#cb26-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-535"><a href="#cb26-535" aria-hidden="true" tabindex="-1"></a><span class="fu"># Bretagne (FR)</span></span>
<span id="cb26-536"><a href="#cb26-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-537"><a href="#cb26-537" aria-hidden="true" tabindex="-1"></a>And in Bretagne region in France between January and August.</span>
<span id="cb26-538"><a href="#cb26-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-541"><a href="#cb26-541" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-542"><a href="#cb26-542" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb26-543"><a href="#cb26-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-544"><a href="#cb26-544" aria-hidden="true" tabindex="-1"></a>nuts_code <span class="ot">&lt;-</span> <span class="st">"FRH"</span></span>
<span id="cb26-545"><a href="#cb26-545" aria-hidden="true" tabindex="-1"></a>nuts1_sel <span class="ot">&lt;-</span> nuts1[nuts1<span class="sc">$</span>NUTS_ID <span class="sc">==</span> nuts_code,]</span>
<span id="cb26-546"><a href="#cb26-546" aria-hidden="true" tabindex="-1"></a>nuts3_sel <span class="ot">&lt;-</span> nuts3[<span class="fu">substr</span>(nuts3<span class="sc">$</span>NUTS_ID, <span class="dv">1</span>, <span class="dv">3</span>) <span class="sc">==</span> nuts_code,]</span>
<span id="cb26-547"><a href="#cb26-547" aria-hidden="true" tabindex="-1"></a>sel <span class="ot">&lt;-</span> <span class="fu">vect</span>(nuts1_sel)</span>
<span id="cb26-548"><a href="#cb26-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-549"><a href="#cb26-549" aria-hidden="true" tabindex="-1"></a>JAN_D_sel <span class="ot">&lt;-</span> <span class="fu">enact_extract</span>(<span class="at">x =</span> JAN_D, <span class="at">sel =</span> nuts1_sel, <span class="at">var_name =</span> <span class="st">"POP_JANV_D_2011"</span>)</span>
<span id="cb26-550"><a href="#cb26-550" aria-hidden="true" tabindex="-1"></a>AOU_D_sel <span class="ot">&lt;-</span> <span class="fu">enact_extract</span>(<span class="at">x =</span> AOU_D, <span class="at">sel =</span> nuts1_sel, <span class="at">var_name =</span> <span class="st">"POP_AOU_D_2011"</span>)</span>
<span id="cb26-551"><a href="#cb26-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-552"><a href="#cb26-552" aria-hidden="true" tabindex="-1"></a>AOU_D_sel <span class="ot">&lt;-</span><span class="fu">st_set_geometry</span>(AOU_D_sel, <span class="cn">NULL</span>)</span>
<span id="cb26-553"><a href="#cb26-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-554"><a href="#cb26-554" aria-hidden="true" tabindex="-1"></a>pt <span class="ot">&lt;-</span> <span class="fu">merge</span>(JAN_D_sel, AOU_D_sel[,,<span class="at">drop =</span> <span class="cn">TRUE</span>], <span class="at">by =</span> <span class="st">"ID"</span>)</span>
<span id="cb26-555"><a href="#cb26-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-556"><a href="#cb26-556" aria-hidden="true" tabindex="-1"></a>pt_n3 <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(pt, nuts3_sel)</span>
<span id="cb26-557"><a href="#cb26-557" aria-hidden="true" tabindex="-1"></a>pt_n3 <span class="ot">&lt;-</span> <span class="fu">st_set_geometry</span>(pt_n3, <span class="cn">NULL</span>)</span>
<span id="cb26-558"><a href="#cb26-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-559"><a href="#cb26-559" aria-hidden="true" tabindex="-1"></a>n3 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(pt_n3[,<span class="fu">c</span>(<span class="st">"POP_JANV_D_2011"</span>,</span>
<span id="cb26-560"><a href="#cb26-560" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"POP_AOU_D_2011"</span>)],</span>
<span id="cb26-561"><a href="#cb26-561" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="fu">list</span>(<span class="at">NAME_LATN =</span> pt_n3<span class="sc">$</span>NAME_LATN),</span>
<span id="cb26-562"><a href="#cb26-562" aria-hidden="true" tabindex="-1"></a>                <span class="at">FUN =</span> sum)</span>
<span id="cb26-563"><a href="#cb26-563" aria-hidden="true" tabindex="-1"></a>n3[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)] <span class="ot">&lt;-</span> n3[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)] <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb26-564"><a href="#cb26-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-565"><a href="#cb26-565" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>), <span class="at">cex.main =</span> <span class="fl">0.9</span>, <span class="at">cex.lab =</span> <span class="fl">0.8</span>, <span class="at">cex.axis =</span> <span class="fl">0.7</span>)</span>
<span id="cb26-566"><a href="#cb26-566" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">cbind</span>(POP_JANV_D_2011,POP_AOU_D_2011) <span class="sc">~</span> NAME_LATN, <span class="at">data =</span> n3, <span class="at">beside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-567"><a href="#cb26-567" aria-hidden="true" tabindex="-1"></a>        <span class="at">border =</span> <span class="cn">FALSE</span>, <span class="at">las =</span> <span class="dv">2</span> , <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"#6bc982"</span>, <span class="st">"#ff697a"</span>), <span class="at">xlab =</span><span class="st">""</span>, <span class="at">axes =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-568"><a href="#cb26-568" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Population (Thousands)"</span>)</span>
<span id="cb26-569"><a href="#cb26-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-570"><a href="#cb26-570" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span> (<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"January"</span>,<span class="st">"August"</span>),</span>
<span id="cb26-571"><a href="#cb26-571" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="fu">c</span>(<span class="st">"#6bc982"</span>, <span class="st">"#ff697a"</span>), <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">bg =</span> <span class="cn">NA</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb26-572"><a href="#cb26-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-573"><a href="#cb26-573" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Resident population, depending on the period of the season"</span>)</span>
<span id="cb26-574"><a href="#cb26-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-575"><a href="#cb26-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-576"><a href="#cb26-576" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 1km reggular grid</span></span>
<span id="cb26-577"><a href="#cb26-577" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">create_grid</span>(<span class="at">x =</span> pt, <span class="at">res =</span> <span class="dv">1000</span>)</span>
<span id="cb26-578"><a href="#cb26-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-579"><a href="#cb26-579" aria-hidden="true" tabindex="-1"></a><span class="co"># Potential in a neighbourhood of 5000m</span></span>
<span id="cb26-580"><a href="#cb26-580" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>POT_JAN_D <span class="ot">&lt;-</span>  <span class="fu">mcpotential</span>(<span class="at">x =</span> pt, <span class="at">y =</span> y, <span class="at">var =</span> <span class="st">"POP_JANV_D_2011"</span>, <span class="at">fun =</span> <span class="st">"e"</span>,</span>
<span id="cb26-581"><a href="#cb26-581" aria-hidden="true" tabindex="-1"></a>                            <span class="at">span =</span> <span class="dv">5000</span>, <span class="at">limit =</span> <span class="dv">10000</span>, <span class="at">beta =</span> <span class="dv">2</span>)</span>
<span id="cb26-582"><a href="#cb26-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-583"><a href="#cb26-583" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>POT_AOU_D <span class="ot">&lt;-</span>  <span class="fu">mcpotential</span>(<span class="at">x =</span> pt, <span class="at">y =</span> y, <span class="at">var =</span> <span class="st">"POP_AOU_D_2011"</span>, <span class="at">fun =</span> <span class="st">"e"</span>,</span>
<span id="cb26-584"><a href="#cb26-584" aria-hidden="true" tabindex="-1"></a>                            <span class="at">span =</span> <span class="dv">5000</span>, <span class="at">limit =</span> <span class="dv">10000</span>, <span class="at">beta =</span> <span class="dv">2</span>)</span>
<span id="cb26-585"><a href="#cb26-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-586"><a href="#cb26-586" aria-hidden="true" tabindex="-1"></a><span class="co"># Resident population day / night</span></span>
<span id="cb26-587"><a href="#cb26-587" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span>DIFF_D <span class="ot">&lt;-</span>  y<span class="sc">$</span>POT_AOU_D <span class="sc">-</span> y<span class="sc">$</span>POT_JAN_D</span>
<span id="cb26-588"><a href="#cb26-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-589"><a href="#cb26-589" aria-hidden="true" tabindex="-1"></a><span class="co"># Quantiles 10, classes, covering the study area</span></span>
<span id="cb26-590"><a href="#cb26-590" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(y, nuts1_sel)</span>
<span id="cb26-591"><a href="#cb26-591" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">&lt;-</span> discr[,<span class="st">"DIFF_D"</span>, drop <span class="ot">=</span> <span class="cn">TRUE</span>]</span>
<span id="cb26-592"><a href="#cb26-592" aria-hidden="true" tabindex="-1"></a>discr <span class="ot">&lt;-</span> <span class="fu">quantile</span>(discr, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-593"><a href="#cb26-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-594"><a href="#cb26-594" aria-hidden="true" tabindex="-1"></a><span class="co"># Diverging palette around 100</span></span>
<span id="cb26-595"><a href="#cb26-595" aria-hidden="true" tabindex="-1"></a>div <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">abs</span>(discr<span class="dv">-100</span>) <span class="sc">==</span> <span class="fu">min</span>(<span class="fu">abs</span>(discr<span class="dv">-100</span>)))</span>
<span id="cb26-596"><a href="#cb26-596" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> cols <span class="ot">&lt;-</span> <span class="fu">mf_get_pal</span>(<span class="at">n =</span> <span class="fu">c</span>(div<span class="dv">-1</span>, <span class="dv">11</span><span class="sc">-</span>div), <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">"Reds 3"</span>, <span class="st">"Greens 3"</span>))</span>
<span id="cb26-597"><a href="#cb26-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-598"><a href="#cb26-598" aria-hidden="true" tabindex="-1"></a><span class="co"># Equipotential</span></span>
<span id="cb26-599"><a href="#cb26-599" aria-hidden="true" tabindex="-1"></a>iso <span class="ot">&lt;-</span> <span class="fu">equipotential</span>(<span class="at">x =</span> y, <span class="at">var =</span> <span class="st">"DIFF_D"</span>, <span class="at">breaks =</span> discr, <span class="at">mask =</span> nuts1_sel)</span>
<span id="cb26-600"><a href="#cb26-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-601"><a href="#cb26-601" aria-hidden="true" tabindex="-1"></a><span class="co"># Map</span></span>
<span id="cb26-602"><a href="#cb26-602" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>))</span>
<span id="cb26-603"><a href="#cb26-603" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> iso, <span class="at">var =</span> <span class="st">"min"</span>, <span class="at">type =</span> <span class="st">"choro"</span>,</span>
<span id="cb26-604"><a href="#cb26-604" aria-hidden="true" tabindex="-1"></a>       <span class="at">breaks =</span> discr, <span class="at">pal =</span> pal, <span class="at">lwd =</span> .<span class="dv">2</span>, <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">leg_val_rnd =</span> <span class="dv">1</span>,</span>
<span id="cb26-605"><a href="#cb26-605" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_pos =</span> <span class="st">"topleft"</span>,</span>
<span id="cb26-606"><a href="#cb26-606" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_title =</span> <span class="fu">paste0</span>(<span class="st">"Difference in resident_population</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb26-607"><a href="#cb26-607" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Between August and January"</span>))</span>
<span id="cb26-608"><a href="#cb26-608" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(<span class="at">x =</span> nuts3_sel, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-609"><a href="#cb26-609" aria-hidden="true" tabindex="-1"></a>tiles_front <span class="ot">&lt;-</span> <span class="fu">get_tiles</span>(nuts2_sel, <span class="at">crop =</span> <span class="cn">TRUE</span>, <span class="at">provider =</span> <span class="st">"CartoDB.PositronOnlyLabels"</span>, <span class="at">zoom =</span> <span class="dv">8</span>)</span>
<span id="cb26-610"><a href="#cb26-610" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_tiles</span>(tiles_front, <span class="at">add =</span> <span class="cn">TRUE</span>)  </span>
<span id="cb26-611"><a href="#cb26-611" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_layout</span>(<span class="at">title =</span> <span class="st">"Resident population - seasonal difference"</span>, </span>
<span id="cb26-612"><a href="#cb26-612" aria-hidden="true" tabindex="-1"></a>          <span class="at">credits =</span> <span class="fu">paste0</span>(<span class="st">"Realisation : Ronan Ysebaert, 2023</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb26-613"><a href="#cb26-613" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Data source : ENACT-POP (Global Human Settlement Layer, JRC, European Commission, 2023"</span>),</span>
<span id="cb26-614"><a href="#cb26-614" aria-hidden="true" tabindex="-1"></a>          <span class="at">arrow =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-615"><a href="#cb26-615" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-616"><a href="#cb26-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-617"><a href="#cb26-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-620"><a href="#cb26-620" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-621"><a href="#cb26-621" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb26-622"><a href="#cb26-622" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>